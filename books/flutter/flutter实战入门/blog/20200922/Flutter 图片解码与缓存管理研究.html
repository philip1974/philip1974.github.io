<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>图片解码 缓存管理 |  Flutter | 老孟</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="../../logo1.png">
    <script src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>(adsbygoogle = window.adsbygoogle || []).push({  google_ad_client: ca-pub-3860386934764403,  enable_page_level_ads: true });</script>
    <script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
    <script>const btw = new BTWPlugin(); setTimeout(function () { btw.init({id: 'app',blogId: '20099-1603808940154-239',name: '老孟Flutter',qrcode: 'http://img.laomengit.com/20201028220227.jpg',keyword: 'vip',});},3000);</script>
    <script src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>(adsbygoogle = window.adsbygoogle || []).push({  google_ad_client: ca-pub-3860386934764403,  enable_page_level_ads: true });</script>
    <meta name="description" content="扫描上方微信，领取《330个控件大全》和 《Flutter 实战》PDF">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="扫描上方微信，领取《330个控件大全》和 《Flutter 实战》PDF">
    <link rel="preload" href="../../assets/css/0.styles.94618c66.css" as="style"><link rel="preload" href="../../assets/js/app.fb541e49.js" as="script"><link rel="preload" href="../../assets/js/2.ed846731.js" as="script"><link rel="preload" href="../../assets/js/23.b97a9de9.js" as="script"><link rel="prefetch" href="../../assets/js/10.9c86fefd.js"><link rel="prefetch" href="../../assets/js/100.cc7f9af3.js"><link rel="prefetch" href="../../assets/js/101.b31e2401.js"><link rel="prefetch" href="../../assets/js/102.0b30ccdf.js"><link rel="prefetch" href="../../assets/js/103.b1bbf41e.js"><link rel="prefetch" href="../../assets/js/104.b7f064d0.js"><link rel="prefetch" href="../../assets/js/105.bd854612.js"><link rel="prefetch" href="../../assets/js/106.6c912bbd.js"><link rel="prefetch" href="../../assets/js/107.b9490dcf.js"><link rel="prefetch" href="../../assets/js/108.133aafde.js"><link rel="prefetch" href="../../assets/js/109.3935dd87.js"><link rel="prefetch" href="../../assets/js/11.8338d8e3.js"><link rel="prefetch" href="../../assets/js/110.ae40c328.js"><link rel="prefetch" href="../../assets/js/111.da281de9.js"><link rel="prefetch" href="../../assets/js/112.f0c6393e.js"><link rel="prefetch" href="../../assets/js/113.4b98631c.js"><link rel="prefetch" href="../../assets/js/114.c6fe9fd6.js"><link rel="prefetch" href="../../assets/js/115.89e5facd.js"><link rel="prefetch" href="../../assets/js/116.ea0ad20a.js"><link rel="prefetch" href="../../assets/js/117.3d3e0739.js"><link rel="prefetch" href="../../assets/js/118.01617441.js"><link rel="prefetch" href="../../assets/js/119.2e7e94e6.js"><link rel="prefetch" href="../../assets/js/12.04bcf5a8.js"><link rel="prefetch" href="../../assets/js/120.f3c1ae4e.js"><link rel="prefetch" href="../../assets/js/121.bb2e907f.js"><link rel="prefetch" href="../../assets/js/122.d6d98adf.js"><link rel="prefetch" href="../../assets/js/123.3b864f6b.js"><link rel="prefetch" href="../../assets/js/124.66acef4f.js"><link rel="prefetch" href="../../assets/js/125.41b3b74f.js"><link rel="prefetch" href="../../assets/js/126.21ff2b3b.js"><link rel="prefetch" href="../../assets/js/127.0a80beca.js"><link rel="prefetch" href="../../assets/js/128.d3f23fc0.js"><link rel="prefetch" href="../../assets/js/129.50cdc824.js"><link rel="prefetch" href="../../assets/js/13.e7d5abfc.js"><link rel="prefetch" href="../../assets/js/130.a5735404.js"><link rel="prefetch" href="../../assets/js/131.352d73db.js"><link rel="prefetch" href="../../assets/js/132.4ce6818e.js"><link rel="prefetch" href="../../assets/js/133.bdb396e8.js"><link rel="prefetch" href="../../assets/js/134.eb219dda.js"><link rel="prefetch" href="../../assets/js/135.623e9bb6.js"><link rel="prefetch" href="../../assets/js/136.0f766fdf.js"><link rel="prefetch" href="../../assets/js/137.58ee1ccd.js"><link rel="prefetch" href="../../assets/js/138.069642a8.js"><link rel="prefetch" href="../../assets/js/139.5102f654.js"><link rel="prefetch" href="../../assets/js/14.b45c46f5.js"><link rel="prefetch" href="../../assets/js/140.9b959c1e.js"><link rel="prefetch" href="../../assets/js/141.660d5f8c.js"><link rel="prefetch" href="../../assets/js/142.f4d8f70c.js"><link rel="prefetch" href="../../assets/js/143.cb60846d.js"><link rel="prefetch" href="../../assets/js/144.0a703b86.js"><link rel="prefetch" href="../../assets/js/145.2567f811.js"><link rel="prefetch" href="../../assets/js/146.2b026dbf.js"><link rel="prefetch" href="../../assets/js/147.b890d706.js"><link rel="prefetch" href="../../assets/js/148.099db2cc.js"><link rel="prefetch" href="../../assets/js/149.faed9ed3.js"><link rel="prefetch" href="../../assets/js/15.122f76be.js"><link rel="prefetch" href="../../assets/js/150.ff2419a6.js"><link rel="prefetch" href="../../assets/js/151.028bad5f.js"><link rel="prefetch" href="../../assets/js/152.7de6faf8.js"><link rel="prefetch" href="../../assets/js/153.1f49a322.js"><link rel="prefetch" href="../../assets/js/154.123edea1.js"><link rel="prefetch" href="../../assets/js/155.4f64820c.js"><link rel="prefetch" href="../../assets/js/156.73b3635e.js"><link rel="prefetch" href="../../assets/js/157.dcd21e67.js"><link rel="prefetch" href="../../assets/js/158.f65b9573.js"><link rel="prefetch" href="../../assets/js/159.e0160ae4.js"><link rel="prefetch" href="../../assets/js/16.04b7da8f.js"><link rel="prefetch" href="../../assets/js/160.e7aca14e.js"><link rel="prefetch" href="../../assets/js/161.c12c9614.js"><link rel="prefetch" href="../../assets/js/162.ee39cc31.js"><link rel="prefetch" href="../../assets/js/163.33f6e8ee.js"><link rel="prefetch" href="../../assets/js/164.f0bb9ba4.js"><link rel="prefetch" href="../../assets/js/165.856d9a9d.js"><link rel="prefetch" href="../../assets/js/166.0844754b.js"><link rel="prefetch" href="../../assets/js/167.30dd35a4.js"><link rel="prefetch" href="../../assets/js/168.16e6ad1d.js"><link rel="prefetch" href="../../assets/js/169.0a163ba4.js"><link rel="prefetch" href="../../assets/js/17.80e1bba6.js"><link rel="prefetch" href="../../assets/js/170.06d71863.js"><link rel="prefetch" href="../../assets/js/171.c95d88f7.js"><link rel="prefetch" href="../../assets/js/172.04060918.js"><link rel="prefetch" href="../../assets/js/173.342a0e48.js"><link rel="prefetch" href="../../assets/js/174.9edb91b7.js"><link rel="prefetch" href="../../assets/js/175.58d33846.js"><link rel="prefetch" href="../../assets/js/176.be87d2b3.js"><link rel="prefetch" href="../../assets/js/177.5f06e21a.js"><link rel="prefetch" href="../../assets/js/178.d38a3dfb.js"><link rel="prefetch" href="../../assets/js/179.70d8dd42.js"><link rel="prefetch" href="../../assets/js/18.4849deaa.js"><link rel="prefetch" href="../../assets/js/180.b007b2ba.js"><link rel="prefetch" href="../../assets/js/181.158adff8.js"><link rel="prefetch" href="../../assets/js/182.46b0a70f.js"><link rel="prefetch" href="../../assets/js/183.05f8eb6a.js"><link rel="prefetch" href="../../assets/js/184.fbfb28ce.js"><link rel="prefetch" href="../../assets/js/185.8c63332b.js"><link rel="prefetch" href="../../assets/js/186.59b33c36.js"><link rel="prefetch" href="../../assets/js/187.f6aae0cc.js"><link rel="prefetch" href="../../assets/js/188.dc683ca9.js"><link rel="prefetch" href="../../assets/js/189.0d39de51.js"><link rel="prefetch" href="../../assets/js/19.d4d751b1.js"><link rel="prefetch" href="../../assets/js/190.1ea35758.js"><link rel="prefetch" href="../../assets/js/191.4cf03f02.js"><link rel="prefetch" href="../../assets/js/192.c2928b4c.js"><link rel="prefetch" href="../../assets/js/193.9ed06450.js"><link rel="prefetch" href="../../assets/js/194.31652ea2.js"><link rel="prefetch" href="../../assets/js/195.06aca932.js"><link rel="prefetch" href="../../assets/js/196.304f724a.js"><link rel="prefetch" href="../../assets/js/197.8e3b2d2a.js"><link rel="prefetch" href="../../assets/js/198.8ec15bed.js"><link rel="prefetch" href="../../assets/js/199.fcea895b.js"><link rel="prefetch" href="../../assets/js/20.ba1b32db.js"><link rel="prefetch" href="../../assets/js/200.9a001c48.js"><link rel="prefetch" href="../../assets/js/201.940f0c1b.js"><link rel="prefetch" href="../../assets/js/202.a5a07eba.js"><link rel="prefetch" href="../../assets/js/203.a02b8267.js"><link rel="prefetch" href="../../assets/js/204.8f963ce9.js"><link rel="prefetch" href="../../assets/js/205.8980b431.js"><link rel="prefetch" href="../../assets/js/206.979f1932.js"><link rel="prefetch" href="../../assets/js/207.7483f2a5.js"><link rel="prefetch" href="../../assets/js/208.8bc560fa.js"><link rel="prefetch" href="../../assets/js/209.2b347bd2.js"><link rel="prefetch" href="../../assets/js/21.308f2dcf.js"><link rel="prefetch" href="../../assets/js/210.ec632d70.js"><link rel="prefetch" href="../../assets/js/211.7631ae15.js"><link rel="prefetch" href="../../assets/js/212.4def8830.js"><link rel="prefetch" href="../../assets/js/213.9f4dfe00.js"><link rel="prefetch" href="../../assets/js/214.fb6d516e.js"><link rel="prefetch" href="../../assets/js/215.61c68b52.js"><link rel="prefetch" href="../../assets/js/216.4b6afa68.js"><link rel="prefetch" href="../../assets/js/217.94b2511a.js"><link rel="prefetch" href="../../assets/js/218.fbcbdfc2.js"><link rel="prefetch" href="../../assets/js/219.f89a8ede.js"><link rel="prefetch" href="../../assets/js/22.35a53d65.js"><link rel="prefetch" href="../../assets/js/220.7ca4a79e.js"><link rel="prefetch" href="../../assets/js/221.4c403e0a.js"><link rel="prefetch" href="../../assets/js/222.f8d2faad.js"><link rel="prefetch" href="../../assets/js/223.2f28faa0.js"><link rel="prefetch" href="../../assets/js/224.270c73ac.js"><link rel="prefetch" href="../../assets/js/225.0fb373d4.js"><link rel="prefetch" href="../../assets/js/226.c715c68c.js"><link rel="prefetch" href="../../assets/js/227.e9aa047a.js"><link rel="prefetch" href="../../assets/js/228.b4b9b5a9.js"><link rel="prefetch" href="../../assets/js/229.3cba88ad.js"><link rel="prefetch" href="../../assets/js/230.32430bdc.js"><link rel="prefetch" href="../../assets/js/231.8092011c.js"><link rel="prefetch" href="../../assets/js/232.4ee1866e.js"><link rel="prefetch" href="../../assets/js/233.99c5a109.js"><link rel="prefetch" href="../../assets/js/234.9b25d984.js"><link rel="prefetch" href="../../assets/js/235.fc49952f.js"><link rel="prefetch" href="../../assets/js/236.31fff311.js"><link rel="prefetch" href="../../assets/js/237.f31bfad5.js"><link rel="prefetch" href="../../assets/js/238.e8ce525a.js"><link rel="prefetch" href="../../assets/js/239.75b02536.js"><link rel="prefetch" href="../../assets/js/24.45287237.js"><link rel="prefetch" href="../../assets/js/240.fa34c63a.js"><link rel="prefetch" href="../../assets/js/241.14037aa4.js"><link rel="prefetch" href="../../assets/js/242.35f51516.js"><link rel="prefetch" href="../../assets/js/243.cf30315b.js"><link rel="prefetch" href="../../assets/js/244.b5a7a52d.js"><link rel="prefetch" href="../../assets/js/245.10136f51.js"><link rel="prefetch" href="../../assets/js/246.5fb5d01d.js"><link rel="prefetch" href="../../assets/js/247.d3200efc.js"><link rel="prefetch" href="../../assets/js/248.c98c01c6.js"><link rel="prefetch" href="../../assets/js/249.679886ec.js"><link rel="prefetch" href="../../assets/js/25.d70e9f50.js"><link rel="prefetch" href="../../assets/js/250.03017324.js"><link rel="prefetch" href="../../assets/js/251.706a87c0.js"><link rel="prefetch" href="../../assets/js/252.58df0767.js"><link rel="prefetch" href="../../assets/js/253.907cb63e.js"><link rel="prefetch" href="../../assets/js/254.c03b6bdc.js"><link rel="prefetch" href="../../assets/js/255.4429330b.js"><link rel="prefetch" href="../../assets/js/256.e2fa8013.js"><link rel="prefetch" href="../../assets/js/257.dc32d74b.js"><link rel="prefetch" href="../../assets/js/258.2670ad34.js"><link rel="prefetch" href="../../assets/js/259.27321517.js"><link rel="prefetch" href="../../assets/js/26.b1e4754b.js"><link rel="prefetch" href="../../assets/js/260.ededf7ae.js"><link rel="prefetch" href="../../assets/js/261.9fde1d55.js"><link rel="prefetch" href="../../assets/js/262.c7e77f3e.js"><link rel="prefetch" href="../../assets/js/263.383ea7fc.js"><link rel="prefetch" href="../../assets/js/264.d6b8e008.js"><link rel="prefetch" href="../../assets/js/265.fd3b1bde.js"><link rel="prefetch" href="../../assets/js/266.47e556a6.js"><link rel="prefetch" href="../../assets/js/267.964a906f.js"><link rel="prefetch" href="../../assets/js/268.fc56c646.js"><link rel="prefetch" href="../../assets/js/269.37dfab97.js"><link rel="prefetch" href="../../assets/js/27.7b17e2df.js"><link rel="prefetch" href="../../assets/js/270.4256fc8c.js"><link rel="prefetch" href="../../assets/js/271.25db331f.js"><link rel="prefetch" href="../../assets/js/272.e7dec7e2.js"><link rel="prefetch" href="../../assets/js/273.3b4a5e8f.js"><link rel="prefetch" href="../../assets/js/274.3d208e61.js"><link rel="prefetch" href="../../assets/js/275.be13f3b7.js"><link rel="prefetch" href="../../assets/js/276.2f9726e2.js"><link rel="prefetch" href="../../assets/js/277.a8ccf0e2.js"><link rel="prefetch" href="../../assets/js/278.6568527a.js"><link rel="prefetch" href="../../assets/js/279.81261a0d.js"><link rel="prefetch" href="../../assets/js/28.d83b5a12.js"><link rel="prefetch" href="../../assets/js/280.94c9cf1d.js"><link rel="prefetch" href="../../assets/js/281.53f85e19.js"><link rel="prefetch" href="../../assets/js/282.08f7fb89.js"><link rel="prefetch" href="../../assets/js/283.e4fddba4.js"><link rel="prefetch" href="../../assets/js/284.4d89aaa5.js"><link rel="prefetch" href="../../assets/js/285.cd927c05.js"><link rel="prefetch" href="../../assets/js/286.121f62e7.js"><link rel="prefetch" href="../../assets/js/287.77bc2205.js"><link rel="prefetch" href="../../assets/js/288.8b346ea7.js"><link rel="prefetch" href="../../assets/js/289.03606b43.js"><link rel="prefetch" href="../../assets/js/29.85246b83.js"><link rel="prefetch" href="../../assets/js/290.da3d6be5.js"><link rel="prefetch" href="../../assets/js/291.ba07ecbe.js"><link rel="prefetch" href="../../assets/js/292.b808b957.js"><link rel="prefetch" href="../../assets/js/293.f7c54f26.js"><link rel="prefetch" href="../../assets/js/294.13ec2e11.js"><link rel="prefetch" href="../../assets/js/295.361da916.js"><link rel="prefetch" href="../../assets/js/296.2232b4b0.js"><link rel="prefetch" href="../../assets/js/297.f333c504.js"><link rel="prefetch" href="../../assets/js/298.eca7d9a9.js"><link rel="prefetch" href="../../assets/js/299.888baf84.js"><link rel="prefetch" href="../../assets/js/3.56190b95.js"><link rel="prefetch" href="../../assets/js/30.05162eb0.js"><link rel="prefetch" href="../../assets/js/300.78ff6de8.js"><link rel="prefetch" href="../../assets/js/301.40fd9663.js"><link rel="prefetch" href="../../assets/js/302.4afce6f6.js"><link rel="prefetch" href="../../assets/js/303.d7a9c085.js"><link rel="prefetch" href="../../assets/js/304.247829a3.js"><link rel="prefetch" href="../../assets/js/305.2dae9659.js"><link rel="prefetch" href="../../assets/js/306.1e5f35c1.js"><link rel="prefetch" href="../../assets/js/307.61c2c485.js"><link rel="prefetch" href="../../assets/js/308.79143ace.js"><link rel="prefetch" href="../../assets/js/309.3bb9edad.js"><link rel="prefetch" href="../../assets/js/31.0fc833df.js"><link rel="prefetch" href="../../assets/js/310.217096f0.js"><link rel="prefetch" href="../../assets/js/311.94e903e6.js"><link rel="prefetch" href="../../assets/js/312.ac261131.js"><link rel="prefetch" href="../../assets/js/313.ae6784e4.js"><link rel="prefetch" href="../../assets/js/314.2dd0489d.js"><link rel="prefetch" href="../../assets/js/315.0c2a740a.js"><link rel="prefetch" href="../../assets/js/316.6d3c06b5.js"><link rel="prefetch" href="../../assets/js/317.403d766e.js"><link rel="prefetch" href="../../assets/js/318.92082b62.js"><link rel="prefetch" href="../../assets/js/319.7bf95004.js"><link rel="prefetch" href="../../assets/js/32.6a9d5e6f.js"><link rel="prefetch" href="../../assets/js/320.b46ae0bd.js"><link rel="prefetch" href="../../assets/js/321.d9dbfff3.js"><link rel="prefetch" href="../../assets/js/322.732074d0.js"><link rel="prefetch" href="../../assets/js/323.4d717129.js"><link rel="prefetch" href="../../assets/js/324.cd692a34.js"><link rel="prefetch" href="../../assets/js/325.1bb28f65.js"><link rel="prefetch" href="../../assets/js/326.2a888516.js"><link rel="prefetch" href="../../assets/js/327.ba989baa.js"><link rel="prefetch" href="../../assets/js/328.12fb00b4.js"><link rel="prefetch" href="../../assets/js/329.77ebf1cd.js"><link rel="prefetch" href="../../assets/js/33.cb6638fc.js"><link rel="prefetch" href="../../assets/js/330.7eb65e19.js"><link rel="prefetch" href="../../assets/js/331.418dee65.js"><link rel="prefetch" href="../../assets/js/332.88baa6cf.js"><link rel="prefetch" href="../../assets/js/333.fbf5a56c.js"><link rel="prefetch" href="../../assets/js/334.74f2b5f6.js"><link rel="prefetch" href="../../assets/js/335.2c1d8208.js"><link rel="prefetch" href="../../assets/js/336.e1d80353.js"><link rel="prefetch" href="../../assets/js/337.c7161013.js"><link rel="prefetch" href="../../assets/js/338.6113b545.js"><link rel="prefetch" href="../../assets/js/339.4e2b4517.js"><link rel="prefetch" href="../../assets/js/34.a27faad2.js"><link rel="prefetch" href="../../assets/js/340.ded55ef1.js"><link rel="prefetch" href="../../assets/js/341.47628199.js"><link rel="prefetch" href="../../assets/js/342.c97a176b.js"><link rel="prefetch" href="../../assets/js/343.18618c73.js"><link rel="prefetch" href="../../assets/js/344.8423f0f1.js"><link rel="prefetch" href="../../assets/js/345.ed069be2.js"><link rel="prefetch" href="../../assets/js/346.0846b221.js"><link rel="prefetch" href="../../assets/js/347.64aaf737.js"><link rel="prefetch" href="../../assets/js/348.eddbb4aa.js"><link rel="prefetch" href="../../assets/js/349.74717fe2.js"><link rel="prefetch" href="../../assets/js/35.5da05f4f.js"><link rel="prefetch" href="../../assets/js/350.cf7dc3be.js"><link rel="prefetch" href="../../assets/js/351.780d8333.js"><link rel="prefetch" href="../../assets/js/352.9738bf81.js"><link rel="prefetch" href="../../assets/js/353.c2b3ad11.js"><link rel="prefetch" href="../../assets/js/354.b173d06d.js"><link rel="prefetch" href="../../assets/js/355.77960a5a.js"><link rel="prefetch" href="../../assets/js/356.79e0ac0f.js"><link rel="prefetch" href="../../assets/js/357.21436a45.js"><link rel="prefetch" href="../../assets/js/358.a4ac47e4.js"><link rel="prefetch" href="../../assets/js/359.7fb266ac.js"><link rel="prefetch" href="../../assets/js/36.6adcbf7d.js"><link rel="prefetch" href="../../assets/js/360.eecff0bd.js"><link rel="prefetch" href="../../assets/js/361.a9cad6c9.js"><link rel="prefetch" href="../../assets/js/362.94c136a4.js"><link rel="prefetch" href="../../assets/js/363.8632b395.js"><link rel="prefetch" href="../../assets/js/364.6a622eef.js"><link rel="prefetch" href="../../assets/js/365.8d4ba528.js"><link rel="prefetch" href="../../assets/js/366.db34c592.js"><link rel="prefetch" href="../../assets/js/367.284b74c7.js"><link rel="prefetch" href="../../assets/js/368.3c72a6d5.js"><link rel="prefetch" href="../../assets/js/369.fb183793.js"><link rel="prefetch" href="../../assets/js/37.36be96ef.js"><link rel="prefetch" href="../../assets/js/370.b6f16557.js"><link rel="prefetch" href="../../assets/js/371.cc0e6776.js"><link rel="prefetch" href="../../assets/js/372.c3178ebe.js"><link rel="prefetch" href="../../assets/js/373.c91f3bb2.js"><link rel="prefetch" href="../../assets/js/374.a374b701.js"><link rel="prefetch" href="../../assets/js/375.105b1408.js"><link rel="prefetch" href="../../assets/js/376.c26d5d7a.js"><link rel="prefetch" href="../../assets/js/377.a8eff236.js"><link rel="prefetch" href="../../assets/js/378.73788d94.js"><link rel="prefetch" href="../../assets/js/379.a4ab03f7.js"><link rel="prefetch" href="../../assets/js/38.ff460382.js"><link rel="prefetch" href="../../assets/js/380.1b3b89fd.js"><link rel="prefetch" href="../../assets/js/381.656ad749.js"><link rel="prefetch" href="../../assets/js/382.682a83d4.js"><link rel="prefetch" href="../../assets/js/383.053f7895.js"><link rel="prefetch" href="../../assets/js/384.ad5f0bc2.js"><link rel="prefetch" href="../../assets/js/385.4d09305c.js"><link rel="prefetch" href="../../assets/js/386.3f63b23e.js"><link rel="prefetch" href="../../assets/js/387.fd664eb5.js"><link rel="prefetch" href="../../assets/js/388.b56e4ece.js"><link rel="prefetch" href="../../assets/js/389.8bcb60c1.js"><link rel="prefetch" href="../../assets/js/39.1d866e08.js"><link rel="prefetch" href="../../assets/js/390.fb252b4c.js"><link rel="prefetch" href="../../assets/js/391.66cddeff.js"><link rel="prefetch" href="../../assets/js/392.2b00d0c4.js"><link rel="prefetch" href="../../assets/js/393.f0f74d19.js"><link rel="prefetch" href="../../assets/js/394.7bce6a0e.js"><link rel="prefetch" href="../../assets/js/4.6c5d0778.js"><link rel="prefetch" href="../../assets/js/40.4f115295.js"><link rel="prefetch" href="../../assets/js/41.9d07033c.js"><link rel="prefetch" href="../../assets/js/42.513da47f.js"><link rel="prefetch" href="../../assets/js/43.727d85f2.js"><link rel="prefetch" href="../../assets/js/44.fb630bae.js"><link rel="prefetch" href="../../assets/js/45.d04fcbc5.js"><link rel="prefetch" href="../../assets/js/46.24285061.js"><link rel="prefetch" href="../../assets/js/47.796b6421.js"><link rel="prefetch" href="../../assets/js/48.25d78428.js"><link rel="prefetch" href="../../assets/js/49.a440c944.js"><link rel="prefetch" href="../../assets/js/5.b9d80dd2.js"><link rel="prefetch" href="../../assets/js/50.0c81a1e6.js"><link rel="prefetch" href="../../assets/js/51.2d7cd9be.js"><link rel="prefetch" href="../../assets/js/52.594621cc.js"><link rel="prefetch" href="../../assets/js/53.0f9f2f6f.js"><link rel="prefetch" href="../../assets/js/54.c9592345.js"><link rel="prefetch" href="../../assets/js/55.c1bbd918.js"><link rel="prefetch" href="../../assets/js/56.58b7bfe1.js"><link rel="prefetch" href="../../assets/js/57.2085641f.js"><link rel="prefetch" href="../../assets/js/58.d68f6f41.js"><link rel="prefetch" href="../../assets/js/59.6e11fbc4.js"><link rel="prefetch" href="../../assets/js/6.4758c40c.js"><link rel="prefetch" href="../../assets/js/60.48302544.js"><link rel="prefetch" href="../../assets/js/61.2f268b24.js"><link rel="prefetch" href="../../assets/js/62.e31cebb8.js"><link rel="prefetch" href="../../assets/js/63.511e8496.js"><link rel="prefetch" href="../../assets/js/64.d8e71117.js"><link rel="prefetch" href="../../assets/js/65.403db591.js"><link rel="prefetch" href="../../assets/js/66.1ca6ca80.js"><link rel="prefetch" href="../../assets/js/67.5c3949ae.js"><link rel="prefetch" href="../../assets/js/68.50ae9cfc.js"><link rel="prefetch" href="../../assets/js/69.6a5fa746.js"><link rel="prefetch" href="../../assets/js/7.129f9956.js"><link rel="prefetch" href="../../assets/js/70.8a421ae2.js"><link rel="prefetch" href="../../assets/js/71.e7712d99.js"><link rel="prefetch" href="../../assets/js/72.0cca711f.js"><link rel="prefetch" href="../../assets/js/73.6ba55720.js"><link rel="prefetch" href="../../assets/js/74.f4379e58.js"><link rel="prefetch" href="../../assets/js/75.b4cb3977.js"><link rel="prefetch" href="../../assets/js/76.85d9bc97.js"><link rel="prefetch" href="../../assets/js/77.7c0a7d87.js"><link rel="prefetch" href="../../assets/js/78.129d87ed.js"><link rel="prefetch" href="../../assets/js/79.6d7e73b2.js"><link rel="prefetch" href="../../assets/js/8.a2c4c507.js"><link rel="prefetch" href="../../assets/js/80.37900447.js"><link rel="prefetch" href="../../assets/js/81.e0bba523.js"><link rel="prefetch" href="../../assets/js/82.5a5d7ac8.js"><link rel="prefetch" href="../../assets/js/83.1f47a97e.js"><link rel="prefetch" href="../../assets/js/84.1884063f.js"><link rel="prefetch" href="../../assets/js/85.33fd01df.js"><link rel="prefetch" href="../../assets/js/86.ef25551d.js"><link rel="prefetch" href="../../assets/js/87.7c55025d.js"><link rel="prefetch" href="../../assets/js/88.8df31138.js"><link rel="prefetch" href="../../assets/js/89.ea12fc8a.js"><link rel="prefetch" href="../../assets/js/9.e6bebbea.js"><link rel="prefetch" href="../../assets/js/90.ae0a2bef.js"><link rel="prefetch" href="../../assets/js/91.7a70b979.js"><link rel="prefetch" href="../../assets/js/92.ff5fe7b2.js"><link rel="prefetch" href="../../assets/js/93.0ca9ec86.js"><link rel="prefetch" href="../../assets/js/94.960c6cc1.js"><link rel="prefetch" href="../../assets/js/95.6dc8bee4.js"><link rel="prefetch" href="../../assets/js/96.d37d1371.js"><link rel="prefetch" href="../../assets/js/97.9c1a648f.js"><link rel="prefetch" href="../../assets/js/98.a8d1fbfd.js"><link rel="prefetch" href="../../assets/js/99.04564c35.js">
    <link rel="stylesheet" href="../../assets/css/0.styles.94618c66.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="../../index.html" class="router-link-active home-link"><img src="../../logo1.png" alt=" Flutter | 老孟" class="logo"> <span class="site-name"> Flutter | 老孟</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../../index.html" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../../flutter/widgets/widgets_structure.html">
          组件
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../../guide/introduction/mobile_system.html">
          实战
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../../decode/InheritedWidget.html">
          源码分析
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="Announcing%20Flutter%201.22.html">
          精彩文章
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../../plugin/upgrade.html">
          插件
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../../plan/Contribution.html">
          投稿
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/781238222/flutter-do" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>往期文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="../20201227/improve_performance.html" class="sidebar-link">如何提高Flutter应用程序的性能</a></li><li><a href="../20201227/roadmap_2021.html" class="sidebar-link">2021 年 Flutter 官方路线图</a></li><li><a href="../20201227/Stateful%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" class="sidebar-link">Stateful组件生命周期</a></li><li><a href="../20201227/%E7%9B%B8%E5%85%B3%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" class="sidebar-link">Flutter 中与平台相关的生命周期</a></li><li><a href="../20201227/build%E6%94%BE%E5%9C%A8State%E4%B8%AD.html" class="sidebar-link">为什么 build 方法放在 State 中而不是在 StatefulWidget 中</a></li><li><a href="6%E4%B8%AA%E6%9E%81%E5%A4%A7%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8C%85.html" class="sidebar-link">6个极大提升开发效率的工具包</a></li><li><a href="main%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0%E4%BC%9A%E8%A2%AB%E8%B0%83%E7%94%A8%E5%87%A0%E6%AC%A1.html" class="sidebar-link">【Flutter 面试】main入口函数会被调用几次</a></li><li><a href="Announcing%20Flutter%201.22.html" class="sidebar-link">Flutter 1.22 正式发布</a></li><li><a href="%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E4%B8%AD%E5%A4%9A%20FlutterView%20%E7%9A%84%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94.html" class="sidebar-link">混合应用中多 FlutterView 的优化方案调研</a></li><li><a href="Flutter%20%E5%9B%BE%E7%89%87%E8%A7%A3%E7%A0%81%E4%B8%8E%E7%BC%93%E5%AD%98%E7%AE%A1%E7%90%86%E7%A0%94%E7%A9%B6.html" class="active sidebar-link">Flutter 图片解码与缓存管理研究</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="#image-widget-and-provider" class="sidebar-link">Image Widget and Provider</a></li><li class="sidebar-sub-header"><a href="#imagecache-%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98" class="sidebar-link">ImageCache 图片缓存</a></li><li class="sidebar-sub-header"><a href="#flutter-%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98" class="sidebar-link">Flutter 图片缓存设计的一些问题</a></li></ul></li><li><a href="%E5%91%8A%E5%88%ABsetState()%EF%BC%81%20%E4%BC%98%E9%9B%85%E7%9A%84UI%E4%B8%8EModel%E7%BB%91%E5%AE%9A%20Flutter%20DataBus%E4%BD%BF%E7%94%A8~.html" class="sidebar-link">告别setState()！ 优雅的UI与Model绑定 Flutter DataBus使用~</a></li><li><a href="Flutter%20%E6%B8%B2%E6%9F%93%E5%BC%95%E6%93%8E%E8%AF%A6%E8%A7%A3%20-%20Android%20GL%20%E7%AF%87.html" class="sidebar-link">Flutter 渲染引擎详解 - Android GL 篇</a></li><li><a href="Flutter%20%E6%B8%B2%E6%9F%93%E5%BC%95%E6%93%8E%E8%AF%A6%E8%A7%A3%20-%20iOS%20GL%20%E7%AF%87.html" class="sidebar-link">Flutter 渲染引擎详解 - iOS GL 篇</a></li><li><a href="Flutter%20%E6%B8%B2%E6%9F%93%E5%BC%95%E6%93%8E%E8%AF%A6%E8%A7%A3%20-%20iOS%20Metal%20%E7%AF%87.html" class="sidebar-link">Flutter 渲染引擎详解 - iOS Metal 篇</a></li><li><a href="Flutter_Windows_Alpha.html" class="sidebar-link">谷歌发布Flutter Alpha：支持Windows</a></li><li><a href="%E3%80%8EFlutter-%E7%BB%98%E5%88%B6%E7%AF%87%E3%80%8F%E5%AE%9E%E7%8E%B0%E7%82%AB%E9%85%B7%E7%9A%84%E9%9B%B7%E7%94%B5%E7%89%B9%E6%95%88.html" class="sidebar-link">『Flutter-绘制篇』实现炫酷的雷电特效</a></li><li><a href="Flutter_Widget.html" class="sidebar-link">Flutter之万物皆Widget</a></li><li><a href="../20200910/shape_clip.html" class="sidebar-link">各种各样形状的组件</a></li><li><a href="../20200910/%E5%AE%9E%E7%8E%B0%E7%82%AB%E9%85%B7%E7%9A%84%E9%9B%A8%E9%9B%AA%E7%89%B9%E6%95%88.html" class="sidebar-link">实现炫酷的雨雪特效</a></li><li><a href="../20200910/%E5%AE%9E%E7%8E%B0%E6%A2%A6%E5%B9%BB%E7%9A%84%E6%99%B4%E6%99%9A%E6%B5%81%E6%98%9F%E6%95%88%E6%9E%9C.html" class="sidebar-link">实现梦幻的晴晚流星效果</a></li><li><a href="../20200909/issue.html" class="sidebar-link">超过百万的 StackOverflow Flutter 问题</a></li><li><a href="../20200909/issue1.html" class="sidebar-link">超过百万的 StackOverflow Flutter 问题(第二期)</a></li><li><a href="../20200909/subtitle.html" class="sidebar-link">实现网易云音乐字幕</a></li><li><a href="../20200909/verification_box.html" class="sidebar-link">验证码输入框</a></li><li><a href="../20200909/Animation.html" class="sidebar-link">17篇动画系列文章带你走进自定义动画</a></li><li><a href="../20200909/LayoutSystemOverview.html" class="sidebar-link">布局系统概述</a></li><li><a href="../20200909/my-first-disappointment-with-flutter.html" class="sidebar-link">我对Flutter的第一次失望</a></li><li><a href="../20200909/barrage.html" class="sidebar-link">虎牙/斗鱼弹幕</a></li><li><a href="../20200909/animated_choose.html" class="sidebar-link">Google 工程师带你选择 Flutter 动画控件</a></li><li><a href="../20200909/DismissKeyboard.html" class="sidebar-link">如何实现全局点击空白处隐藏键盘</a></li><li><a href="../20200909/iconfont.html" class="sidebar-link">使用阿里巴巴 icon 库</a></li><li><a href="../20200909/tips_1.html" class="sidebar-link">一行禁用 App，一行置灰 App，致敬</a></li></ul></section></li></ul></aside> <main class="page"> <header><div style="text-align: center; padding-bottom: 30px;margin: 100px 0 0 0;"><div style="display:inline-block;"><img src="http://img.laomengit.com/laomeng_qr_1.png" style="height:180px;box-shadow:#aaa 5px 5px 10px"> <p>微信交流群</p></div> <div class="ad" style="display:inline-block;margin:0 0 0 30px"><a href="https://item.jd.com/12673329.html" onclick="buy("img")" title="点击购买" target="_blank"><img src="http://img.laomengit.com/flutter_cover.png" style="height:300px;box-shadow:#aaa 5px 5px 10px"></a> <br> <a onclick="buy("btn")" href="https://item.jd.com/12673329.html" title="点击购买" target="_blank" class="buy-btn">点击购买</a></div></div></header> <div class="theme-antdocs-content content__default"><blockquote><p>作者：易旭昕</p> <p>原文链接：<a href="https://zhuanlan.zhihu.com/p/154404908" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/154404908<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p><strong>写作费时，敬请点赞，关注，收藏三连。</strong></p> <p>图片解码和缓存管理是渲染引擎的一个重要模块，这是因为图片解码的耗时很长，特别是对于设计为跨平台的通用渲染引擎来说，依赖于CPU来做图片解码，会消耗大量的CPU时间，并且图片解码后占用的内存很大，一张 1024x1024 分辨率的图片解码后就需要 4M 内存（除非硬件支持实时生成无损压缩格式纹理，通常这也不在通用渲染引擎的考虑范围之内）。所以一个设计良好的图片解码和缓存管理模块需要平衡很多不同的因素，包括内存占用，CPU占用，解码任务调度的及时性等。</p> <p>在对 Flutter 的图片解码和缓存管理模块进行研究后，发现它跟 Chromium 有很大的差别。一方面它实现比较简单，给予了应用更直接的控制权，引擎本身只提供了最基本的支持，更契合 Native UI 的实际使用场景，另外一方面因为引擎本身缺少控制权，如果应用生成的 UI 界面较为极端，可能会导致比较灾难性的结果。</p> <p>在这篇文章，我会先对 Flutter 的图片解码和缓存管理机制进行说明。然后再说明这种机制存在的一些问题。</p> <h2 id="image-widget-and-provider"><a href="#image-widget-and-provider" class="header-anchor">#</a> Image Widget and Provider</h2> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">Image</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token comment">/// The image to display.</span>
  <span class="token keyword">final</span> ImageProvider image<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">NetworkImage</span> <span class="token keyword">extends</span> <span class="token class-name">ImageProvider</span><span class="token operator">&lt;</span>NetworkImage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Flutter 通过 Image.asset，Image.file，Image.network 等方法创建一个 Image Widget 来显示图片，方法名字说明了图片数据的来源，他们实际上是为 Image Widget 提供了不同的 ImageProvider，比如说 Image.network 创建的 Image Widget，它的 ImageProvider 就是 NetworkImage。因为 Image Widget 是一个 StatefulWidget，所以它核心的状态处理逻辑代码是位于 _ImageState 对象中，由它来创建真正显示图片的 RawImage Widget。</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">_ImageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>Image<span class="token operator">&gt;</span> <span class="token keyword">with</span> WidgetsBindingObserver <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">_updateInvertColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_resolveImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>TickerMode<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">_listenToStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      <span class="token function">_stopListeningToStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_resolveImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> ScrollAwareImageProvider provider <span class="token operator">=</span> ScrollAwareImageProvider<span class="token operator">&lt;</span><span class="token keyword">dynamic</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
      context<span class="token punctuation">:</span> _scrollAwareContext<span class="token punctuation">,</span>
      imageProvider<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>image<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> ImageStream newStream <span class="token operator">=</span>
      provider<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">createLocalImageConfiguration</span><span class="token punctuation">(</span>
        context<span class="token punctuation">,</span>
        size<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>width <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> widget<span class="token punctuation">.</span>height <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">Size</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>width<span class="token punctuation">,</span> widget<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>newStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_updateSourceStream</span><span class="token punctuation">(</span>newStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_handleImageFrame</span><span class="token punctuation">(</span>ImageInfo imageInfo<span class="token punctuation">,</span> bool synchronousCall<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _imageInfo <span class="token operator">=</span> imageInfo<span class="token punctuation">;</span>
      _loadingProgress <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      _frameNumber <span class="token operator">=</span> _frameNumber <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> _frameNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      _wasSynchronouslyLoaded <span class="token operator">|=</span> synchronousCall<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><blockquote><p>ScrollAwareImageProvider 是新版本新增的优化，它包装了最初的 ImageProvider，用来避免在快速滚动的过程中加载图片，也就是说快速滚动过程新增的 Image Widget，它加载图片的时机会被延迟，如果它在滚动过程中移除屏幕然后被移除，就完全不会触发加载。</p></blockquote> <p>当 Image Widget 被加入到 UI 的 Widget 树时，Flutter 就会调用 _ImageState.didChangeDependencies，然后 _ImageState._resolveImage 被调用，最后调用 ImageProvider.resolve 来加载图片。ImageProvider.resolve 触发了一连串的事情发生，它会先在 ImageCache 中生成 Entry，然后开始加载数据（异步方法，由 ImageProvider 的子类提供），加载完数据后生成相应的 Codec 开始请求解码（异步方法，由 Native Engine 提供），解码完成后最终通知 _ImageState._handleImageFrame 改变状态，产生新的 child Widget 显示图片。</p> <blockquote><p>Flutter 单帧图片的解码是运行在 worker 线程池（可以并发），解码后的 GPU 纹理上传是 io 线程，多帧图片的解码和纹理上传都是在 io 线程。</p></blockquote> <p>也就是说：</p> <ol><li>Flutter 图片解码的调度和图片缓存的管理都在 Widget 层，由 Image Widget 关联的 _ImageState 对象和 ImageProvider 对象负责；</li> <li>图片缓存的实现是 ImageCache 对象，通过 PaintingBinding.instance.imageCache 访问，ImageProvider 封装了 ImageCache 的访问；</li> <li>当 Image Widget 被加入 Widget 树，就会触发图片的加载，加载完后就会自动请求解码，加载和解码是连在一起不可分割的；</li> <li>解码完成后 Image Widget 才会产生 RawImage 作为 child Widget 真正显示图片。</li></ol> <h2 id="imagecache-图片缓存"><a href="#imagecache-%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98" class="header-anchor">#</a> ImageCache 图片缓存</h2> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">ImageCache</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> _PendingImage<span class="token operator">&gt;</span> _pendingImages <span class="token operator">=</span> <span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> _PendingImage<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> _CachedImage<span class="token operator">&gt;</span> _cache <span class="token operator">=</span> <span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> _CachedImage<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> Map<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> _LiveImage<span class="token operator">&gt;</span> _liveImages <span class="token operator">=</span> <span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> _LiveImage<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>


  ImageStreamCompleter <span class="token function">putIfAbsent</span><span class="token punctuation">(</span>Object key<span class="token punctuation">,</span> ImageStreamCompleter <span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>ImageErrorListener onError<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>当 ImageProvide.resolve 被调用时，它会去调用 ImageCache.putIfAbsent 生成 Cache Entry（Key 由 ImageProvider 产生），返回一个 ImageStreamCompleter 对象用于监听图片加载和解码完成的情况，如果已经有缓存的 Entry，则直接返回。</p> <p>ImageCache 实际上有三个 Pool，分别是 Pending，Cache 和 Live Pool，一个新的 Entry 一开始会被加入到这三个 Pool 中。Pending Pool 用来跟踪正在加载和解码的图片，当图片加载和解码完成后，ImageCache 会自动移除 Pending Pool 相应的 Entry。Live Pool 是用来跟踪使用中的图片，当 Image Widget 移除或者更换图片，或者 Image Widget 自身被移除，ImageCache 会从 Live Pool 移除相应的 Entry。如果图片缓存的数量和内存占用大小没有超过 ImageCache 的上限，Cache Pool 就会一直保留 Cache Entry，如果超过则按 LRU 进行释放。<strong>只有 ImageCache 从所有 Pool 都释放了同一个图片的 Entry，该图片解码后生成的纹理内存才会真正被释放</strong>。</p> <p>我们可以通过一个实际的场景来说明 ImageCache 的处理逻辑。假设 ImageCache 缓存的限制是 100M（100M 也是 Flutter 的默认值），我们的 UI 陆续加入 200 个 Image Widget，每个 Image Widget 显示一个 512x512 的图片，每个图片解码后的纹理内存占用为 1M。</p> <ol><li>当 UI 加入 100 个 Image Widget 的时候，Live Pool 和 Cache Pool 都有对应 100 个 Entey，假设图片都已经加载和解码完毕，Pending Pool 里面的 Entry 被全部移除，当前总的图片纹理缓存占用为 100M；</li> <li>当加入 101 个 Image Widget，并且图片加载和解码完毕的时候，Live Pool 里面有 101 个 Entry，但是 Cache Pool 因为超过上限，最初的 Entry 被移除，只保留了后面 100 个 Entry，当前总的图片纹理缓存占用为 101M；</li> <li>当加入 200 个 Image Widget，并且图片加载和解码完毕的时候，Live Pool 里面有 200 个 Entry，但是 Cache Pool 因为超过上限，最初的 100 个 Entry 被移除，只保留了后面 100 个 Entry，当前总的图片纹理缓存占用为 200M；</li> <li>我们移除这 200 个 Image Widget，Live Pool 的 Entry 被完全移除，但是 Cache Pool 没有超过上限，仍然保留，当前总的图片纹理缓存占用为 100M；</li> <li>我们使用后 100 张同样的图片重新加入 100 个 Image Widget，因为图片已经存在于 Cache Pool，所以不需要重新加载和解码，ImageCache 会从 Cache Pool 里面取出对应 Entry，并且重新在 Live Pool 生成对应的 Entry，最后 Live Pool 和 Cache Pool 都包含同样的 100 个 Entry，当前总的图片纹理缓存占用为 100M；</li> <li>我们继续使用前 100 张图片再加入 100 个 Image Widget，因为 Cache Pool 已经移除了对应的 Entry，所以需要重新加载和解码，最终 Live Pool 包含了 200 个 Entry，Cache Pool 包含 100 对应前 100 张图片的 Entry，当前总的图片纹理缓存占用为 200M；</li> <li>我们再次移除所有的 Image Widget，并且手动设置 ImageCache 的内存上限为 0，这样 ImageCache 会移除 Live Pool 和 Cache Pool 的所有 Entry，当前总的图片纹理缓存占用为 0M；</li></ol> <h2 id="flutter-图片缓存设计的一些问题"><a href="#flutter-%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98" class="header-anchor">#</a> Flutter 图片缓存设计的一些问题</h2> <p>应该说 Flutter 的图片缓存设计还是比较契合 Native UI 的使用场景的，但是对于一些设计比较糟糕的 UI，或者是自动生成的类 Web 的长页面，这样的设计可能会造成一些灾难性的后果。</p> <ol><li>Flutter 解码的时机非常靠前，如果一次性加入大量的 Image Widget 对象，会马上产生相应数量的加载和解码任务，这可能造成系统较为严重的阻塞，并且部分 Image Widget 实际上可能距离可见区域较远，解码后产生的纹理暂时不会被使用，这造成了内存浪费；</li> <li>ImageCache 实际上是没有真正封顶的（Live Pool 是无上限的），如果当前的 Widget 树同时包含了大量的 Image Widget，内存峰值可能会非常夸张，很容易造成 OOM；</li> <li>ImageCache 是在 Framework 层的实现而不是 Engine 层，它的实例由 Widget 层产生，通过 PaintingBinding.instance.imageCache 访问，这意味着每个 FlutterView，每个 Root Isolate 都有一个不同的 ImageCache，如果是混合应用，同时展现多个 FlutterView，不但 ImageCache 的 Live Pool 没法控制，Cache Pool 也会处于叠加的状态，导致内存的峰值会更难以控制；</li></ol> <blockquote><p>目前已经有不少尝试是先生成 DOM 树，然后再用不同的后端将 DOM 树转换成适合不同渲染引擎的产物，交给对应的引擎去渲染。比如生成真正的 Web DOM 交给 Web 引擎渲染，或者生成 Flutter Widget 树交给 Flutter 渲染。这种代码自动生成的 Widget 树可能存在的一个问题就是可能会一次性生成大量的 Widget，并且同时加入 Widget 树。</p></blockquote></div> <footer class="page-edit"><div class="gitbook-donate"><div></div> <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}"><span>喜欢作者</span></button><div id="QR" style="display: none;"><div id="wechat" style="display: inline-block"><a href="http://img.laomengit.com/laomeng_reward.png" rel="group" class="fancybox"><img id="wechat_qr" src="http://img.laomengit.com/laomeng_reward.png" alt="WeChat Pay"></a> <p>微信打赏</p></div></div></div> <!----></footer> <div class="page-nav"><p class="copyright">
      版权所有，禁止私自转发、克隆网站。
  </p> <p class="inner"><span class="prev"><a href="%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E4%B8%AD%E5%A4%9A%20FlutterView%20%E7%9A%84%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        混合应用中多 FlutterView 的优化方案调研
      </a></span> <span class="next"><a href="%E5%91%8A%E5%88%ABsetState()%EF%BC%81%20%E4%BC%98%E9%9B%85%E7%9A%84UI%E4%B8%8EModel%E7%BB%91%E5%AE%9A%20Flutter%20DataBus%E4%BD%BF%E7%94%A8~.html">
        告别setState()！ 优雅的UI与Model绑定 Flutter DataBus使用~
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"><div class="reading-progress top" data-v-21b39eda><div class="progress" data-v-21b39eda></div></div></div></div>
    <script src="../../assets/js/app.fb541e49.js" defer></script><script src="../../assets/js/2.ed846731.js" defer></script><script src="../../assets/js/23.b97a9de9.js" defer></script>
  </body>
</html>