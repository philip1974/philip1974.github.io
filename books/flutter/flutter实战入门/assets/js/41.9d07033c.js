(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{741:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"老孟flutter-stateful-组件的生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#老孟flutter-stateful-组件的生命周期"}},[t._v("#")]),t._v(" [老孟Flutter] Stateful 组件的生命周期")]),t._v(" "),a("p",[t._v("此篇文章介绍 StatefulWidget 组件的生命周期， StatefulWidget 组件的生命周期时非常重要的知识点，就像 Android 中 Activity 的生命周期一样，不仅在以后的工作中经常用到，面试也会经常被问到。")]),t._v(" "),a("p",[t._v("在 Flutter 中一切皆 "),a("strong",[t._v("组件")]),t._v("，而组件又分为 "),a("strong",[t._v("StatefulWidget（有状态）")]),t._v(" 和 **StatelessWidget（无状态）**组件 ，他们之间的区别是 StatelessWidget 组件发生变化时必须重新创建新的实例，而 StatefulWidget 组件则可以直接改变当前组件的状态而无需重新创建新的实例。")]),t._v(" "),a("blockquote",[a("p",[t._v("注意：使用的 Flutter 版本 和 Dart 版本如下：")]),t._v(" "),a("p",[t._v("Flutter 1.22.4 • channel stable • https://github.com/flutter/flutter.git\nFramework • revision 1aafb3a8b9 (6 weeks ago) • 2020-11-13 09:59:28 -0800\nEngine • revision 2c956a31c0\nTools • Dart 2.10.4")]),t._v(" "),a("p",[t._v("不同的版本 StatefulWidget 组件的生命周期会有差异。")])]),t._v(" "),a("p",[t._v("下面的 StatefulWidget 和 State 结构图是StatefulWidget 组件生命周期的概览，不同版本的差异也可以对比此结构图。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.laomengit.com/20201227205850.png",alt:""}})]),t._v(" "),a("p",[t._v("生命周期流程图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.laomengit.com/20201227210050.png",alt:""}})]),t._v(" "),a("p",[t._v("下面详细介绍 StatefulWidget 组件的生命周期。")]),t._v(" "),a("h4",{attrs:{id:"生命周期一：createstate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期一：createstate"}},[t._v("#")]),t._v(" 生命周期一：createState")]),t._v(" "),a("p",[t._v("下面是一个非常简单的 StatefulWidget 组件：")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatefulWidgetDemo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatefulWidget")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  _StatefulWidgetDemoState "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_StatefulWidgetDemoState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("_StatefulWidgetDemoState")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("State")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("StatefulWidgetDemo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  Widget "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Container")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("当我们构建一个  StatefulWidget 组件时，首先执行其"),a("strong",[t._v("构造函数")]),t._v("（上面的代码没有显示的构造函数，但有默认的无参构造函数），然后执行 "),a("strong",[t._v("createState")]),t._v(" 函数。但构造函数并不是生命周期的一部分。")]),t._v(" "),a("p",[t._v("当 StatefulWidget 组件插入到组件树中时 "),a("strong",[t._v("createState")]),t._v(" 函数由 "),a("strong",[t._v("Framework")]),t._v(" 调用，此函数在树中给定的位置为此组件创建 "),a("strong",[t._v("State")]),t._v("，如果在组件树的不同位置都插入了此组件，即创建了多个此组件，如下：")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Row")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MyStatefulWidget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MyStatefulWidget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MyStatefulWidget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("那么系统会为每一个组件创建一个单独的 "),a("strong",[t._v("State")]),t._v("，当组件从组件树中移除，然后重新插入到组件树中时， "),a("strong",[t._v("createState")]),t._v(" 函数将会被调用创建一个新的 "),a("strong",[t._v("State")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("createState")]),t._v(" 函数执行完毕后表示当前组件已经在组件树中，此时有一个非常重要的属性 "),a("strong",[t._v("mounted")]),t._v(" 被 "),a("strong",[t._v("Framework")]),t._v(" 设置为 "),a("strong",[t._v("true")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"生命周期二：initstate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期二：initstate"}},[t._v("#")]),t._v(" 生命周期二：initState")]),t._v(" "),a("p",[a("strong",[t._v("initState")]),t._v(" 函数在组件被插入树中时被 Framework 调用（在 "),a("strong",[t._v("createState")]),t._v(" 之后），此函数只会被调用一次，子类通常会重写此方法，在其中进行初始化操作，比如加载网络数据，重写此方法时一定要调用 "),a("strong",[t._v("super.initState()")]),t._v("，如下：")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("如果此组件需要订阅通知，比如 "),a("strong",[t._v("ChangeNotifier")]),t._v(" 或者 "),a("strong",[t._v("Stream")]),t._v("，则需要在不同的生命周期内正确处理订阅和取消订阅通知。")]),t._v(" "),a("ul",[a("li",[t._v("在 "),a("strong",[t._v("initState")]),t._v(" 中订阅通知。")]),t._v(" "),a("li",[t._v("在 "),a("strong",[t._v("didUpdateWidget")]),t._v(" 中，如果需要替换旧组件，则在旧对象中取消订阅，并在新对象中订阅通知。")]),t._v(" "),a("li",[t._v("并在 "),a("strong",[t._v("dispose")]),t._v(" 中取消订阅。")])]),t._v(" "),a("p",[t._v("另外在此函数中不能调用 "),a("strong",[t._v("BuildContext.dependOnInheritedWidgetOfExactType")]),t._v("，典型的错误写法如下：")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  IconTheme iconTheme "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dependOnInheritedWidgetOfExactType"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IconTheme"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("异常信息如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.laomengit.com/20201227210101.png",alt:""}})]),t._v(" "),a("p",[t._v("解决方案：")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("didChangeDependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("didChangeDependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dependOnInheritedWidgetOfExactType"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IconTheme"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("上面的用法作为初学者使用的比较少，但下面的错误代码大部分应该都写过：")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showDialog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("builder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AlertDialog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("异常信息如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.laomengit.com/20201227210028.png",alt:""}})]),t._v(" "),a("p",[t._v("解决方案：")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  WidgetsBinding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addPostFrameCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timeStamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showDialog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("builder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AlertDialog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AlertDialog'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("blockquote",[a("p",[t._v("注意：弹出 AlertDialog 在 didChangeDependencies 中调用也会出现异常，但和上面的异常不是同一个。")])]),t._v(" "),a("h4",{attrs:{id:"生命周期三：didchangedependencies"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期三：didchangedependencies"}},[t._v("#")]),t._v(" 生命周期三：didChangeDependencies")]),t._v(" "),a("p",[t._v("didChangeDependencies 方法在 initState 之后由 Framework 立即调用。另外，当此 "),a("strong",[t._v("State")]),t._v(" 对象的依赖项更改时被调用，比如其所依赖的 "),a("strong",[t._v("InheritedWidget")]),t._v(" 发生变化时， Framework 会调用此方法通知组件发生变化。")]),t._v(" "),a("p",[t._v("此方法是生命周期中第一个可以使用 "),a("strong",[t._v("BuildContext.dependOnInheritedWidgetOfExactType")]),t._v(" 的方法，此方法很少会被重写，因为 Framework 会在依赖发生变化时调用 "),a("strong",[t._v("build")]),t._v("，需要重写此方法的场景是：依赖发生变化时需要做一些耗时任务，比如网络请求数据。")]),t._v(" "),a("p",[t._v("didChangeDependencies 方法调用后，组件的状态变为 "),a("strong",[t._v("dirty")]),t._v("，立即调用 build 方法。")]),t._v(" "),a("h4",{attrs:{id:"生命周期四：build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期四：build"}},[t._v("#")]),t._v(" 生命周期四：build")]),t._v(" "),a("p",[t._v("此方法是我们最熟悉的，在方法中创建各种组件，绘制到屏幕上。 Framework会在多种情况下调用此方法：")]),t._v(" "),a("ul",[a("li",[t._v("调用 "),a("strong",[t._v("initState")]),t._v(" 方法后。")]),t._v(" "),a("li",[t._v("调用 "),a("strong",[t._v("didUpdateWidget")]),t._v(" 方法后。")]),t._v(" "),a("li",[t._v("收到对 "),a("strong",[t._v("setState")]),t._v(" 的调用后。")]),t._v(" "),a("li",[t._v("此 "),a("strong",[t._v("State")]),t._v(" 对象的依存关系发生更改后（例如，依赖的 "),a("strong",[t._v("InheritedWidget")]),t._v(" 发生了更改）。")]),t._v(" "),a("li",[t._v("调用 "),a("strong",[t._v("deactivate")]),t._v(" 之后，然后将 "),a("strong",[t._v("State")]),t._v(" 对象重新插入树的另一个位置。")])]),t._v(" "),a("p",[t._v("此方法可以在每一帧中调用，此方法中应该只包含构建组件的代码，不应该包含其他额外的功能，尤其是耗时任务。")]),t._v(" "),a("h4",{attrs:{id:"生命周期五：didupdatewidget"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期五：didupdatewidget"}},[t._v("#")]),t._v(" 生命周期五：didUpdateWidget")]),t._v(" "),a("p",[t._v("当组件的 "),a("strong",[t._v("configuration")]),t._v(" 发生变化时调用此函数，当父组件使用相同的 "),a("strong",[t._v("runtimeType")]),t._v(" 和 "),a("strong",[t._v("Widget.key")]),t._v(" 重新构建一个新的组件时，Framework 将更新此 "),a("strong",[t._v("State")]),t._v(" 对象的组件属性以引用新的组件，然后使用先前的组件作为参数调用此方法。")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("didUpdateWidget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("covariant StatefulLifecycle oldWidget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("didUpdateWidget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldWidget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'didUpdateWidget'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("此方法中通常会用当前组件与前组件进行对比。Framework 调用完此方法后，会将组件设置为 "),a("strong",[t._v("dirty")]),t._v(" 状态，然后调用 "),a("strong",[t._v("build")]),t._v(" 方法，因此无需在此方法中调用 "),a("strong",[t._v("setState")]),t._v(" 方法。")]),t._v(" "),a("h4",{attrs:{id:"生命周期六：deactivate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期六：deactivate"}},[t._v("#")]),t._v(" 生命周期六：deactivate")]),t._v(" "),a("p",[t._v("当框架从树中移除此 State 对象时将会调用此方法，在某些情况下，框架将重新插入 State 对象到树的其他位置（例如，如果包含该树的子树 State 对象从树中的一个位置移植到另一位置），框架将会调用 build 方法来提供 State 对象适应其在树中的新位置。")]),t._v(" "),a("h4",{attrs:{id:"生命周期七：dispose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期七：dispose"}},[t._v("#")]),t._v(" 生命周期七：dispose")]),t._v(" "),a("p",[t._v("当框架从树中永久移除此 State 对象时将会调用此方法，与 "),a("strong",[t._v("deactivate")]),t._v(" 的区别是，"),a("strong",[t._v("deactivate")]),t._v(" 还可以重新插入到树中，而 "),a("strong",[t._v("dispose")]),t._v(" 表示此 State 对象永远不会在 "),a("strong",[t._v("build")]),t._v("。调用完 "),a("strong",[t._v("dispose")]),t._v("后，"),a("strong",[t._v("mounted")]),t._v(" 属性被设置为 false，也代表组件生命周期的结束，此时再调用 "),a("strong",[t._v("setState")]),t._v(" 方法将会抛出异常。")]),t._v(" "),a("p",[t._v("子类重写此方法，释放相关资源，比如动画等。")]),t._v(" "),a("h4",{attrs:{id:"非常重要的几个概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非常重要的几个概念"}},[t._v("#")]),t._v(" 非常重要的几个概念")]),t._v(" "),a("p",[t._v("下面介绍几个非常重要的概念和方法，这些并不是生命周期的一部分，但是生命周期过程中的产物，与生命周期关系非常紧密。")]),t._v(" "),a("h5",{attrs:{id:"mounted"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mounted"}},[t._v("#")]),t._v(" mounted")]),t._v(" "),a("p",[a("strong",[t._v("mounted")]),t._v(" 是 State 对象中的一个属性，此属性表示当前组件是否在树中，在创建 "),a("strong",[t._v("State")]),t._v(" 之后，调用 "),a("strong",[t._v("initState")]),t._v(" 之前，Framework 会将 "),a("strong",[t._v("State")]),t._v(" 和 "),a("strong",[t._v("BuildContext")]),t._v(" 进行关联，当 Framework 调用 "),a("strong",[t._v("dispose")]),t._v(" 时，mounted 被设置为 false，表示当前组件已经不在树中。")]),t._v(" "),a("p",[a("strong",[t._v("createState")]),t._v(" 函数执行完毕后表示当前组件已经在组件树中，属性 "),a("strong",[t._v("mounted")]),t._v(" 被 "),a("strong",[t._v("Framework")]),t._v(" 设置为 "),a("strong",[t._v("true")]),t._v("，平时写代码时或者看其他开源代码时经常看到如下代码：")]),t._v(" "),a("div",{staticClass:"language-dart line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mounted"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("blockquote",[a("p",[t._v("强烈建议：在调用 "),a("strong",[t._v("setState")]),t._v(" 时加上 mounted 判断。")])]),t._v(" "),a("p",[t._v("为什么要加上如此判断？因为如果当前组件未插入到树中或者已经从树中移除时，调用 "),a("strong",[t._v("setState")]),t._v(" 会抛出异常，加上 "),a("strong",[t._v("mounted")]),t._v(" 判断，则表示当前组件在树中。")]),t._v(" "),a("h5",{attrs:{id:"dirty-和-clean"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dirty-和-clean"}},[t._v("#")]),t._v(" dirty 和 clean")]),t._v(" "),a("p",[a("strong",[t._v("dirty")]),t._v(" 表示组件当前的状态为 "),a("strong",[t._v("脏状态")]),t._v("，下一帧时将会执行 "),a("strong",[t._v("build")]),t._v(" 函数，调用 "),a("strong",[t._v("setState")]),t._v(" 方法或者 执行 "),a("strong",[t._v("didUpdateWidget")]),t._v(" 方法后，组件的状态为 "),a("strong",[t._v("dirty")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("clean")]),t._v(" 与 "),a("strong",[t._v("dirty")]),t._v(" 相对应，"),a("strong",[t._v("clean")]),t._v(" 表示组件当前的状态为 "),a("strong",[t._v("干净状态")]),t._v("，"),a("strong",[t._v("clean")]),t._v(" 状态下组件不会执行  "),a("strong",[t._v("build")]),t._v(" 函数。")]),t._v(" "),a("h5",{attrs:{id:"setstate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setstate"}},[t._v("#")]),t._v(" setState")]),t._v(" "),a("p",[a("strong",[t._v("setState")]),t._v(" 方法是开发者经常调用的方法，此方法调用后，组件的状态变为 "),a("strong",[t._v("dirty")]),t._v("，当有数据要更新时，调用此方法。")]),t._v(" "),a("h5",{attrs:{id:"reassemble"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reassemble"}},[t._v("#")]),t._v(" reassemble")]),t._v(" "),a("p",[a("strong",[t._v("reassemble")]),t._v(" 用于开发，比如 "),a("strong",[t._v("hot reload")]),t._v(" ，在 release 版本中不会回调此方法。")])])}),[],!1,null,null,null);s.default=e.exports}}]);