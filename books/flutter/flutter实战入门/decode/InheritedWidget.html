<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>InheritedWidget 源码分析 |  Flutter | 老孟</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="../logo1.png">
    <script src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>(adsbygoogle = window.adsbygoogle || []).push({  google_ad_client: ca-pub-3860386934764403,  enable_page_level_ads: true });</script>
    <script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
    <script>const btw = new BTWPlugin(); setTimeout(function () { btw.init({id: 'app',blogId: '20099-1603808940154-239',name: '老孟Flutter',qrcode: 'http://img.laomengit.com/20201028220227.jpg',keyword: 'vip',});},3000);</script>
    <script src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>(adsbygoogle = window.adsbygoogle || []).push({  google_ad_client: ca-pub-3860386934764403,  enable_page_level_ads: true });</script>
    <meta name="description" content="扫描上方微信，领取《330个控件大全》和 《Flutter 实战》PDF">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="扫描上方微信，领取《330个控件大全》和 《Flutter 实战》PDF">
    <link rel="preload" href="../assets/css/0.styles.94618c66.css" as="style"><link rel="preload" href="../assets/js/app.fb541e49.js" as="script"><link rel="preload" href="../assets/js/2.ed846731.js" as="script"><link rel="preload" href="../assets/js/55.c1bbd918.js" as="script"><link rel="prefetch" href="../assets/js/10.9c86fefd.js"><link rel="prefetch" href="../assets/js/100.cc7f9af3.js"><link rel="prefetch" href="../assets/js/101.b31e2401.js"><link rel="prefetch" href="../assets/js/102.0b30ccdf.js"><link rel="prefetch" href="../assets/js/103.b1bbf41e.js"><link rel="prefetch" href="../assets/js/104.b7f064d0.js"><link rel="prefetch" href="../assets/js/105.bd854612.js"><link rel="prefetch" href="../assets/js/106.6c912bbd.js"><link rel="prefetch" href="../assets/js/107.b9490dcf.js"><link rel="prefetch" href="../assets/js/108.133aafde.js"><link rel="prefetch" href="../assets/js/109.3935dd87.js"><link rel="prefetch" href="../assets/js/11.8338d8e3.js"><link rel="prefetch" href="../assets/js/110.ae40c328.js"><link rel="prefetch" href="../assets/js/111.da281de9.js"><link rel="prefetch" href="../assets/js/112.f0c6393e.js"><link rel="prefetch" href="../assets/js/113.4b98631c.js"><link rel="prefetch" href="../assets/js/114.c6fe9fd6.js"><link rel="prefetch" href="../assets/js/115.89e5facd.js"><link rel="prefetch" href="../assets/js/116.ea0ad20a.js"><link rel="prefetch" href="../assets/js/117.3d3e0739.js"><link rel="prefetch" href="../assets/js/118.01617441.js"><link rel="prefetch" href="../assets/js/119.2e7e94e6.js"><link rel="prefetch" href="../assets/js/12.04bcf5a8.js"><link rel="prefetch" href="../assets/js/120.f3c1ae4e.js"><link rel="prefetch" href="../assets/js/121.bb2e907f.js"><link rel="prefetch" href="../assets/js/122.d6d98adf.js"><link rel="prefetch" href="../assets/js/123.3b864f6b.js"><link rel="prefetch" href="../assets/js/124.66acef4f.js"><link rel="prefetch" href="../assets/js/125.41b3b74f.js"><link rel="prefetch" href="../assets/js/126.21ff2b3b.js"><link rel="prefetch" href="../assets/js/127.0a80beca.js"><link rel="prefetch" href="../assets/js/128.d3f23fc0.js"><link rel="prefetch" href="../assets/js/129.50cdc824.js"><link rel="prefetch" href="../assets/js/13.e7d5abfc.js"><link rel="prefetch" href="../assets/js/130.a5735404.js"><link rel="prefetch" href="../assets/js/131.352d73db.js"><link rel="prefetch" href="../assets/js/132.4ce6818e.js"><link rel="prefetch" href="../assets/js/133.bdb396e8.js"><link rel="prefetch" href="../assets/js/134.eb219dda.js"><link rel="prefetch" href="../assets/js/135.623e9bb6.js"><link rel="prefetch" href="../assets/js/136.0f766fdf.js"><link rel="prefetch" href="../assets/js/137.58ee1ccd.js"><link rel="prefetch" href="../assets/js/138.069642a8.js"><link rel="prefetch" href="../assets/js/139.5102f654.js"><link rel="prefetch" href="../assets/js/14.b45c46f5.js"><link rel="prefetch" href="../assets/js/140.9b959c1e.js"><link rel="prefetch" href="../assets/js/141.660d5f8c.js"><link rel="prefetch" href="../assets/js/142.f4d8f70c.js"><link rel="prefetch" href="../assets/js/143.cb60846d.js"><link rel="prefetch" href="../assets/js/144.0a703b86.js"><link rel="prefetch" href="../assets/js/145.2567f811.js"><link rel="prefetch" href="../assets/js/146.2b026dbf.js"><link rel="prefetch" href="../assets/js/147.b890d706.js"><link rel="prefetch" href="../assets/js/148.099db2cc.js"><link rel="prefetch" href="../assets/js/149.faed9ed3.js"><link rel="prefetch" href="../assets/js/15.122f76be.js"><link rel="prefetch" href="../assets/js/150.ff2419a6.js"><link rel="prefetch" href="../assets/js/151.028bad5f.js"><link rel="prefetch" href="../assets/js/152.7de6faf8.js"><link rel="prefetch" href="../assets/js/153.1f49a322.js"><link rel="prefetch" href="../assets/js/154.123edea1.js"><link rel="prefetch" href="../assets/js/155.4f64820c.js"><link rel="prefetch" href="../assets/js/156.73b3635e.js"><link rel="prefetch" href="../assets/js/157.dcd21e67.js"><link rel="prefetch" href="../assets/js/158.f65b9573.js"><link rel="prefetch" href="../assets/js/159.e0160ae4.js"><link rel="prefetch" href="../assets/js/16.04b7da8f.js"><link rel="prefetch" href="../assets/js/160.e7aca14e.js"><link rel="prefetch" href="../assets/js/161.c12c9614.js"><link rel="prefetch" href="../assets/js/162.ee39cc31.js"><link rel="prefetch" href="../assets/js/163.33f6e8ee.js"><link rel="prefetch" href="../assets/js/164.f0bb9ba4.js"><link rel="prefetch" href="../assets/js/165.856d9a9d.js"><link rel="prefetch" href="../assets/js/166.0844754b.js"><link rel="prefetch" href="../assets/js/167.30dd35a4.js"><link rel="prefetch" href="../assets/js/168.16e6ad1d.js"><link rel="prefetch" href="../assets/js/169.0a163ba4.js"><link rel="prefetch" href="../assets/js/17.80e1bba6.js"><link rel="prefetch" href="../assets/js/170.06d71863.js"><link rel="prefetch" href="../assets/js/171.c95d88f7.js"><link rel="prefetch" href="../assets/js/172.04060918.js"><link rel="prefetch" href="../assets/js/173.342a0e48.js"><link rel="prefetch" href="../assets/js/174.9edb91b7.js"><link rel="prefetch" href="../assets/js/175.58d33846.js"><link rel="prefetch" href="../assets/js/176.be87d2b3.js"><link rel="prefetch" href="../assets/js/177.5f06e21a.js"><link rel="prefetch" href="../assets/js/178.d38a3dfb.js"><link rel="prefetch" href="../assets/js/179.70d8dd42.js"><link rel="prefetch" href="../assets/js/18.4849deaa.js"><link rel="prefetch" href="../assets/js/180.b007b2ba.js"><link rel="prefetch" href="../assets/js/181.158adff8.js"><link rel="prefetch" href="../assets/js/182.46b0a70f.js"><link rel="prefetch" href="../assets/js/183.05f8eb6a.js"><link rel="prefetch" href="../assets/js/184.fbfb28ce.js"><link rel="prefetch" href="../assets/js/185.8c63332b.js"><link rel="prefetch" href="../assets/js/186.59b33c36.js"><link rel="prefetch" href="../assets/js/187.f6aae0cc.js"><link rel="prefetch" href="../assets/js/188.dc683ca9.js"><link rel="prefetch" href="../assets/js/189.0d39de51.js"><link rel="prefetch" href="../assets/js/19.d4d751b1.js"><link rel="prefetch" href="../assets/js/190.1ea35758.js"><link rel="prefetch" href="../assets/js/191.4cf03f02.js"><link rel="prefetch" href="../assets/js/192.c2928b4c.js"><link rel="prefetch" href="../assets/js/193.9ed06450.js"><link rel="prefetch" href="../assets/js/194.31652ea2.js"><link rel="prefetch" href="../assets/js/195.06aca932.js"><link rel="prefetch" href="../assets/js/196.304f724a.js"><link rel="prefetch" href="../assets/js/197.8e3b2d2a.js"><link rel="prefetch" href="../assets/js/198.8ec15bed.js"><link rel="prefetch" href="../assets/js/199.fcea895b.js"><link rel="prefetch" href="../assets/js/20.ba1b32db.js"><link rel="prefetch" href="../assets/js/200.9a001c48.js"><link rel="prefetch" href="../assets/js/201.940f0c1b.js"><link rel="prefetch" href="../assets/js/202.a5a07eba.js"><link rel="prefetch" href="../assets/js/203.a02b8267.js"><link rel="prefetch" href="../assets/js/204.8f963ce9.js"><link rel="prefetch" href="../assets/js/205.8980b431.js"><link rel="prefetch" href="../assets/js/206.979f1932.js"><link rel="prefetch" href="../assets/js/207.7483f2a5.js"><link rel="prefetch" href="../assets/js/208.8bc560fa.js"><link rel="prefetch" href="../assets/js/209.2b347bd2.js"><link rel="prefetch" href="../assets/js/21.308f2dcf.js"><link rel="prefetch" href="../assets/js/210.ec632d70.js"><link rel="prefetch" href="../assets/js/211.7631ae15.js"><link rel="prefetch" href="../assets/js/212.4def8830.js"><link rel="prefetch" href="../assets/js/213.9f4dfe00.js"><link rel="prefetch" href="../assets/js/214.fb6d516e.js"><link rel="prefetch" href="../assets/js/215.61c68b52.js"><link rel="prefetch" href="../assets/js/216.4b6afa68.js"><link rel="prefetch" href="../assets/js/217.94b2511a.js"><link rel="prefetch" href="../assets/js/218.fbcbdfc2.js"><link rel="prefetch" href="../assets/js/219.f89a8ede.js"><link rel="prefetch" href="../assets/js/22.35a53d65.js"><link rel="prefetch" href="../assets/js/220.7ca4a79e.js"><link rel="prefetch" href="../assets/js/221.4c403e0a.js"><link rel="prefetch" href="../assets/js/222.f8d2faad.js"><link rel="prefetch" href="../assets/js/223.2f28faa0.js"><link rel="prefetch" href="../assets/js/224.270c73ac.js"><link rel="prefetch" href="../assets/js/225.0fb373d4.js"><link rel="prefetch" href="../assets/js/226.c715c68c.js"><link rel="prefetch" href="../assets/js/227.e9aa047a.js"><link rel="prefetch" href="../assets/js/228.b4b9b5a9.js"><link rel="prefetch" href="../assets/js/229.3cba88ad.js"><link rel="prefetch" href="../assets/js/23.b97a9de9.js"><link rel="prefetch" href="../assets/js/230.32430bdc.js"><link rel="prefetch" href="../assets/js/231.8092011c.js"><link rel="prefetch" href="../assets/js/232.4ee1866e.js"><link rel="prefetch" href="../assets/js/233.99c5a109.js"><link rel="prefetch" href="../assets/js/234.9b25d984.js"><link rel="prefetch" href="../assets/js/235.fc49952f.js"><link rel="prefetch" href="../assets/js/236.31fff311.js"><link rel="prefetch" href="../assets/js/237.f31bfad5.js"><link rel="prefetch" href="../assets/js/238.e8ce525a.js"><link rel="prefetch" href="../assets/js/239.75b02536.js"><link rel="prefetch" href="../assets/js/24.45287237.js"><link rel="prefetch" href="../assets/js/240.fa34c63a.js"><link rel="prefetch" href="../assets/js/241.14037aa4.js"><link rel="prefetch" href="../assets/js/242.35f51516.js"><link rel="prefetch" href="../assets/js/243.cf30315b.js"><link rel="prefetch" href="../assets/js/244.b5a7a52d.js"><link rel="prefetch" href="../assets/js/245.10136f51.js"><link rel="prefetch" href="../assets/js/246.5fb5d01d.js"><link rel="prefetch" href="../assets/js/247.d3200efc.js"><link rel="prefetch" href="../assets/js/248.c98c01c6.js"><link rel="prefetch" href="../assets/js/249.679886ec.js"><link rel="prefetch" href="../assets/js/25.d70e9f50.js"><link rel="prefetch" href="../assets/js/250.03017324.js"><link rel="prefetch" href="../assets/js/251.706a87c0.js"><link rel="prefetch" href="../assets/js/252.58df0767.js"><link rel="prefetch" href="../assets/js/253.907cb63e.js"><link rel="prefetch" href="../assets/js/254.c03b6bdc.js"><link rel="prefetch" href="../assets/js/255.4429330b.js"><link rel="prefetch" href="../assets/js/256.e2fa8013.js"><link rel="prefetch" href="../assets/js/257.dc32d74b.js"><link rel="prefetch" href="../assets/js/258.2670ad34.js"><link rel="prefetch" href="../assets/js/259.27321517.js"><link rel="prefetch" href="../assets/js/26.b1e4754b.js"><link rel="prefetch" href="../assets/js/260.ededf7ae.js"><link rel="prefetch" href="../assets/js/261.9fde1d55.js"><link rel="prefetch" href="../assets/js/262.c7e77f3e.js"><link rel="prefetch" href="../assets/js/263.383ea7fc.js"><link rel="prefetch" href="../assets/js/264.d6b8e008.js"><link rel="prefetch" href="../assets/js/265.fd3b1bde.js"><link rel="prefetch" href="../assets/js/266.47e556a6.js"><link rel="prefetch" href="../assets/js/267.964a906f.js"><link rel="prefetch" href="../assets/js/268.fc56c646.js"><link rel="prefetch" href="../assets/js/269.37dfab97.js"><link rel="prefetch" href="../assets/js/27.7b17e2df.js"><link rel="prefetch" href="../assets/js/270.4256fc8c.js"><link rel="prefetch" href="../assets/js/271.25db331f.js"><link rel="prefetch" href="../assets/js/272.e7dec7e2.js"><link rel="prefetch" href="../assets/js/273.3b4a5e8f.js"><link rel="prefetch" href="../assets/js/274.3d208e61.js"><link rel="prefetch" href="../assets/js/275.be13f3b7.js"><link rel="prefetch" href="../assets/js/276.2f9726e2.js"><link rel="prefetch" href="../assets/js/277.a8ccf0e2.js"><link rel="prefetch" href="../assets/js/278.6568527a.js"><link rel="prefetch" href="../assets/js/279.81261a0d.js"><link rel="prefetch" href="../assets/js/28.d83b5a12.js"><link rel="prefetch" href="../assets/js/280.94c9cf1d.js"><link rel="prefetch" href="../assets/js/281.53f85e19.js"><link rel="prefetch" href="../assets/js/282.08f7fb89.js"><link rel="prefetch" href="../assets/js/283.e4fddba4.js"><link rel="prefetch" href="../assets/js/284.4d89aaa5.js"><link rel="prefetch" href="../assets/js/285.cd927c05.js"><link rel="prefetch" href="../assets/js/286.121f62e7.js"><link rel="prefetch" href="../assets/js/287.77bc2205.js"><link rel="prefetch" href="../assets/js/288.8b346ea7.js"><link rel="prefetch" href="../assets/js/289.03606b43.js"><link rel="prefetch" href="../assets/js/29.85246b83.js"><link rel="prefetch" href="../assets/js/290.da3d6be5.js"><link rel="prefetch" href="../assets/js/291.ba07ecbe.js"><link rel="prefetch" href="../assets/js/292.b808b957.js"><link rel="prefetch" href="../assets/js/293.f7c54f26.js"><link rel="prefetch" href="../assets/js/294.13ec2e11.js"><link rel="prefetch" href="../assets/js/295.361da916.js"><link rel="prefetch" href="../assets/js/296.2232b4b0.js"><link rel="prefetch" href="../assets/js/297.f333c504.js"><link rel="prefetch" href="../assets/js/298.eca7d9a9.js"><link rel="prefetch" href="../assets/js/299.888baf84.js"><link rel="prefetch" href="../assets/js/3.56190b95.js"><link rel="prefetch" href="../assets/js/30.05162eb0.js"><link rel="prefetch" href="../assets/js/300.78ff6de8.js"><link rel="prefetch" href="../assets/js/301.40fd9663.js"><link rel="prefetch" href="../assets/js/302.4afce6f6.js"><link rel="prefetch" href="../assets/js/303.d7a9c085.js"><link rel="prefetch" href="../assets/js/304.247829a3.js"><link rel="prefetch" href="../assets/js/305.2dae9659.js"><link rel="prefetch" href="../assets/js/306.1e5f35c1.js"><link rel="prefetch" href="../assets/js/307.61c2c485.js"><link rel="prefetch" href="../assets/js/308.79143ace.js"><link rel="prefetch" href="../assets/js/309.3bb9edad.js"><link rel="prefetch" href="../assets/js/31.0fc833df.js"><link rel="prefetch" href="../assets/js/310.217096f0.js"><link rel="prefetch" href="../assets/js/311.94e903e6.js"><link rel="prefetch" href="../assets/js/312.ac261131.js"><link rel="prefetch" href="../assets/js/313.ae6784e4.js"><link rel="prefetch" href="../assets/js/314.2dd0489d.js"><link rel="prefetch" href="../assets/js/315.0c2a740a.js"><link rel="prefetch" href="../assets/js/316.6d3c06b5.js"><link rel="prefetch" href="../assets/js/317.403d766e.js"><link rel="prefetch" href="../assets/js/318.92082b62.js"><link rel="prefetch" href="../assets/js/319.7bf95004.js"><link rel="prefetch" href="../assets/js/32.6a9d5e6f.js"><link rel="prefetch" href="../assets/js/320.b46ae0bd.js"><link rel="prefetch" href="../assets/js/321.d9dbfff3.js"><link rel="prefetch" href="../assets/js/322.732074d0.js"><link rel="prefetch" href="../assets/js/323.4d717129.js"><link rel="prefetch" href="../assets/js/324.cd692a34.js"><link rel="prefetch" href="../assets/js/325.1bb28f65.js"><link rel="prefetch" href="../assets/js/326.2a888516.js"><link rel="prefetch" href="../assets/js/327.ba989baa.js"><link rel="prefetch" href="../assets/js/328.12fb00b4.js"><link rel="prefetch" href="../assets/js/329.77ebf1cd.js"><link rel="prefetch" href="../assets/js/33.cb6638fc.js"><link rel="prefetch" href="../assets/js/330.7eb65e19.js"><link rel="prefetch" href="../assets/js/331.418dee65.js"><link rel="prefetch" href="../assets/js/332.88baa6cf.js"><link rel="prefetch" href="../assets/js/333.fbf5a56c.js"><link rel="prefetch" href="../assets/js/334.74f2b5f6.js"><link rel="prefetch" href="../assets/js/335.2c1d8208.js"><link rel="prefetch" href="../assets/js/336.e1d80353.js"><link rel="prefetch" href="../assets/js/337.c7161013.js"><link rel="prefetch" href="../assets/js/338.6113b545.js"><link rel="prefetch" href="../assets/js/339.4e2b4517.js"><link rel="prefetch" href="../assets/js/34.a27faad2.js"><link rel="prefetch" href="../assets/js/340.ded55ef1.js"><link rel="prefetch" href="../assets/js/341.47628199.js"><link rel="prefetch" href="../assets/js/342.c97a176b.js"><link rel="prefetch" href="../assets/js/343.18618c73.js"><link rel="prefetch" href="../assets/js/344.8423f0f1.js"><link rel="prefetch" href="../assets/js/345.ed069be2.js"><link rel="prefetch" href="../assets/js/346.0846b221.js"><link rel="prefetch" href="../assets/js/347.64aaf737.js"><link rel="prefetch" href="../assets/js/348.eddbb4aa.js"><link rel="prefetch" href="../assets/js/349.74717fe2.js"><link rel="prefetch" href="../assets/js/35.5da05f4f.js"><link rel="prefetch" href="../assets/js/350.cf7dc3be.js"><link rel="prefetch" href="../assets/js/351.780d8333.js"><link rel="prefetch" href="../assets/js/352.9738bf81.js"><link rel="prefetch" href="../assets/js/353.c2b3ad11.js"><link rel="prefetch" href="../assets/js/354.b173d06d.js"><link rel="prefetch" href="../assets/js/355.77960a5a.js"><link rel="prefetch" href="../assets/js/356.79e0ac0f.js"><link rel="prefetch" href="../assets/js/357.21436a45.js"><link rel="prefetch" href="../assets/js/358.a4ac47e4.js"><link rel="prefetch" href="../assets/js/359.7fb266ac.js"><link rel="prefetch" href="../assets/js/36.6adcbf7d.js"><link rel="prefetch" href="../assets/js/360.eecff0bd.js"><link rel="prefetch" href="../assets/js/361.a9cad6c9.js"><link rel="prefetch" href="../assets/js/362.94c136a4.js"><link rel="prefetch" href="../assets/js/363.8632b395.js"><link rel="prefetch" href="../assets/js/364.6a622eef.js"><link rel="prefetch" href="../assets/js/365.8d4ba528.js"><link rel="prefetch" href="../assets/js/366.db34c592.js"><link rel="prefetch" href="../assets/js/367.284b74c7.js"><link rel="prefetch" href="../assets/js/368.3c72a6d5.js"><link rel="prefetch" href="../assets/js/369.fb183793.js"><link rel="prefetch" href="../assets/js/37.36be96ef.js"><link rel="prefetch" href="../assets/js/370.b6f16557.js"><link rel="prefetch" href="../assets/js/371.cc0e6776.js"><link rel="prefetch" href="../assets/js/372.c3178ebe.js"><link rel="prefetch" href="../assets/js/373.c91f3bb2.js"><link rel="prefetch" href="../assets/js/374.a374b701.js"><link rel="prefetch" href="../assets/js/375.105b1408.js"><link rel="prefetch" href="../assets/js/376.c26d5d7a.js"><link rel="prefetch" href="../assets/js/377.a8eff236.js"><link rel="prefetch" href="../assets/js/378.73788d94.js"><link rel="prefetch" href="../assets/js/379.a4ab03f7.js"><link rel="prefetch" href="../assets/js/38.ff460382.js"><link rel="prefetch" href="../assets/js/380.1b3b89fd.js"><link rel="prefetch" href="../assets/js/381.656ad749.js"><link rel="prefetch" href="../assets/js/382.682a83d4.js"><link rel="prefetch" href="../assets/js/383.053f7895.js"><link rel="prefetch" href="../assets/js/384.ad5f0bc2.js"><link rel="prefetch" href="../assets/js/385.4d09305c.js"><link rel="prefetch" href="../assets/js/386.3f63b23e.js"><link rel="prefetch" href="../assets/js/387.fd664eb5.js"><link rel="prefetch" href="../assets/js/388.b56e4ece.js"><link rel="prefetch" href="../assets/js/389.8bcb60c1.js"><link rel="prefetch" href="../assets/js/39.1d866e08.js"><link rel="prefetch" href="../assets/js/390.fb252b4c.js"><link rel="prefetch" href="../assets/js/391.66cddeff.js"><link rel="prefetch" href="../assets/js/392.2b00d0c4.js"><link rel="prefetch" href="../assets/js/393.f0f74d19.js"><link rel="prefetch" href="../assets/js/394.7bce6a0e.js"><link rel="prefetch" href="../assets/js/4.6c5d0778.js"><link rel="prefetch" href="../assets/js/40.4f115295.js"><link rel="prefetch" href="../assets/js/41.9d07033c.js"><link rel="prefetch" href="../assets/js/42.513da47f.js"><link rel="prefetch" href="../assets/js/43.727d85f2.js"><link rel="prefetch" href="../assets/js/44.fb630bae.js"><link rel="prefetch" href="../assets/js/45.d04fcbc5.js"><link rel="prefetch" href="../assets/js/46.24285061.js"><link rel="prefetch" href="../assets/js/47.796b6421.js"><link rel="prefetch" href="../assets/js/48.25d78428.js"><link rel="prefetch" href="../assets/js/49.a440c944.js"><link rel="prefetch" href="../assets/js/5.b9d80dd2.js"><link rel="prefetch" href="../assets/js/50.0c81a1e6.js"><link rel="prefetch" href="../assets/js/51.2d7cd9be.js"><link rel="prefetch" href="../assets/js/52.594621cc.js"><link rel="prefetch" href="../assets/js/53.0f9f2f6f.js"><link rel="prefetch" href="../assets/js/54.c9592345.js"><link rel="prefetch" href="../assets/js/56.58b7bfe1.js"><link rel="prefetch" href="../assets/js/57.2085641f.js"><link rel="prefetch" href="../assets/js/58.d68f6f41.js"><link rel="prefetch" href="../assets/js/59.6e11fbc4.js"><link rel="prefetch" href="../assets/js/6.4758c40c.js"><link rel="prefetch" href="../assets/js/60.48302544.js"><link rel="prefetch" href="../assets/js/61.2f268b24.js"><link rel="prefetch" href="../assets/js/62.e31cebb8.js"><link rel="prefetch" href="../assets/js/63.511e8496.js"><link rel="prefetch" href="../assets/js/64.d8e71117.js"><link rel="prefetch" href="../assets/js/65.403db591.js"><link rel="prefetch" href="../assets/js/66.1ca6ca80.js"><link rel="prefetch" href="../assets/js/67.5c3949ae.js"><link rel="prefetch" href="../assets/js/68.50ae9cfc.js"><link rel="prefetch" href="../assets/js/69.6a5fa746.js"><link rel="prefetch" href="../assets/js/7.129f9956.js"><link rel="prefetch" href="../assets/js/70.8a421ae2.js"><link rel="prefetch" href="../assets/js/71.e7712d99.js"><link rel="prefetch" href="../assets/js/72.0cca711f.js"><link rel="prefetch" href="../assets/js/73.6ba55720.js"><link rel="prefetch" href="../assets/js/74.f4379e58.js"><link rel="prefetch" href="../assets/js/75.b4cb3977.js"><link rel="prefetch" href="../assets/js/76.85d9bc97.js"><link rel="prefetch" href="../assets/js/77.7c0a7d87.js"><link rel="prefetch" href="../assets/js/78.129d87ed.js"><link rel="prefetch" href="../assets/js/79.6d7e73b2.js"><link rel="prefetch" href="../assets/js/8.a2c4c507.js"><link rel="prefetch" href="../assets/js/80.37900447.js"><link rel="prefetch" href="../assets/js/81.e0bba523.js"><link rel="prefetch" href="../assets/js/82.5a5d7ac8.js"><link rel="prefetch" href="../assets/js/83.1f47a97e.js"><link rel="prefetch" href="../assets/js/84.1884063f.js"><link rel="prefetch" href="../assets/js/85.33fd01df.js"><link rel="prefetch" href="../assets/js/86.ef25551d.js"><link rel="prefetch" href="../assets/js/87.7c55025d.js"><link rel="prefetch" href="../assets/js/88.8df31138.js"><link rel="prefetch" href="../assets/js/89.ea12fc8a.js"><link rel="prefetch" href="../assets/js/9.e6bebbea.js"><link rel="prefetch" href="../assets/js/90.ae0a2bef.js"><link rel="prefetch" href="../assets/js/91.7a70b979.js"><link rel="prefetch" href="../assets/js/92.ff5fe7b2.js"><link rel="prefetch" href="../assets/js/93.0ca9ec86.js"><link rel="prefetch" href="../assets/js/94.960c6cc1.js"><link rel="prefetch" href="../assets/js/95.6dc8bee4.js"><link rel="prefetch" href="../assets/js/96.d37d1371.js"><link rel="prefetch" href="../assets/js/97.9c1a648f.js"><link rel="prefetch" href="../assets/js/98.a8d1fbfd.js"><link rel="prefetch" href="../assets/js/99.04564c35.js">
    <link rel="stylesheet" href="../assets/css/0.styles.94618c66.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="../index.html" class="router-link-active home-link"><img src="../logo1.png" alt=" Flutter | 老孟" class="logo"> <span class="site-name"> Flutter | 老孟</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../index.html" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../flutter/widgets/widgets_structure.html">
          组件
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../guide/introduction/mobile_system.html">
          实战
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item ant-menu-item-selected"><a href="InheritedWidget.html" class="router-link-exact-active router-link-active">
          源码分析
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../blog/20200922/Announcing%20Flutter%201.22.html">
          精彩文章
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../plugin/upgrade.html">
          插件
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="../plan/Contribution.html">
          投稿
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/781238222/flutter-do" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>源码分析</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="InheritedWidget.html" class="active sidebar-link">InheritedWidget</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul></aside> <main class="page"> <header><div style="text-align: center; padding-bottom: 30px;margin: 100px 0 0 0;"><div style="display:inline-block;"><img src="http://img.laomengit.com/laomeng_qr_1.png" style="height:180px;box-shadow:#aaa 5px 5px 10px"> <p>微信交流群</p></div> <div class="ad" style="display:inline-block;margin:0 0 0 30px"><a href="https://item.jd.com/12673329.html" onclick="buy("img")" title="点击购买" target="_blank"><img src="http://img.laomengit.com/flutter_cover.png" style="height:300px;box-shadow:#aaa 5px 5px 10px"></a> <br> <a onclick="buy("btn")" href="https://item.jd.com/12673329.html" title="点击购买" target="_blank" class="buy-btn">点击购买</a></div></div></header> <div class="theme-antdocs-content content__default"><blockquote><p><strong>老孟导读</strong>：这是2021年源码系列的第一篇文章，其实源码系列的文章不是特别受欢迎，一个原因是原理性的知识非常枯燥，我自己看源码的时候特别有感触，二是想把源码分析讲的通俗易懂非常困难，自己明白 和 让别人听懂完全是两回事。不过我依然会坚持 Flutter 源码系列的文章，提高自己的技术水平的同时，也希望大家收获一些知识。</p></blockquote> <p>为了使源码系列的文章不那么枯燥，文章中会有很多流程图，流程图比纯文字更直观，一图胜千言。</p> <p>我也是第一次写源码系列的文章，如果文章哪里有不对的地方请告诉我，虽然我也不一定听😄，开个玩笑。</p> <p>希望大家来个 <strong>赞</strong>，您的 <strong>赞</strong>是我写下去的巨大动力😄。</p> <p>所有源码系列文章都会分享到我个人博客：<a href="../index.html" target="_blank" rel="noopener noreferrer">http://laomengit.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="正文"><a href="#%E6%AD%A3%E6%96%87" class="header-anchor">#</a> 正文</h3> <blockquote><p>注意：使用的 Flutter 版本 和 Dart 版本如下：</p> <p>Flutter 1.22.4 • channel stable • https://github.com/flutter/flutter.git
Framework • revision 1aafb3a8b9 (6 weeks ago) • 2020-11-13 09:59:28 -0800
Engine • revision 2c956a31c0
Tools • Dart 2.10.4</p> <p>不同的版本可能有所不同，请注意版本之间的区别。</p></blockquote> <p>首先， <strong>InheritedWidget</strong> 是一个<strong>非常重要</strong>，<strong>非常重要</strong>，<strong>非常重要</strong>的组件，重要的事情说3遍😄，系统中很多功能都是功能型组件都是通过 InheritedWidget 实现的，著名的 <strong>Provider</strong> 状态管理框架也是基于 InheritedWidget 实现的，因此不管是工作中，还是面试，InheritedWidget 组件的原理及使用场景都是考察的重点。</p> <p>此篇文章包括如下几个部分：</p> <ul><li>InheritedWidget 组件简介，是什么场景下使用 InheritedWidget？</li> <li>InheritedWidget 基本用法。</li> <li>InheritedWidget 源码分析。</li></ul> <h3 id="inheritedwidget-组件简介"><a href="#inheritedwidget-%E7%BB%84%E4%BB%B6%E7%AE%80%E4%BB%8B" class="header-anchor">#</a> InheritedWidget 组件简介</h3> <p>InheritedWidget 组件是功能型组件，提供了<strong>沿树向下，共享数据</strong>的功能，即子组件可以获取父组件(InheritedWidget 的子类)的数据，通过<strong>BuildContext.dependOnInheritedWidgetOfExactType</strong> 获取。</p> <p>InheritedWidget 组件的共享数据是沿着树从上到下，是否联想到 <strong>Notification</strong>，Notification 正好与 InheritedWidget 传递方向相反，Notification 是沿着树从下到上，两者功能的实现都是子节点主动发起，InheritedWidget 组件的子节点主动查找父节点上 InheritedWidget 共享的数据，Notification 也是子节点主动发起通知，沿着树向上通知。</p> <p><strong>Notification</strong> 也是 Flutter 中非常重要的，后面会有专门的文章详细介绍，此篇不做介绍。</p> <p>那么什么样的场景适合使用 InheritedWidget 呢? 通常App会有登录用户信息，登录用户信息为全局共享信息，想象一下，子组件要如何获取登录用户信息？将上面的场景抽象一下，有一颗组件树，A、H 组件依赖同一数据，如下：</p> <p><img src="http://img.laomengit.com/20210117145052.png" alt=""></p> <p>A、H 组件要如何获取到数据呢？</p> <p>有一种实现方式是 <strong>通过构造函数透传</strong>，数据通过A传递给B，B传递给C、E，C和E在传递给F、H，如下图虚线的传递:</p> <p><img src="http://img.laomengit.com/20210117145058.png" alt=""></p> <p>反应到代码上就是:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">return</span> <span class="token function">A</span><span class="token punctuation">(</span>
  data<span class="token punctuation">:</span>data
  child<span class="token punctuation">:</span><span class="token function">B</span><span class="token punctuation">(</span>
    data<span class="token punctuation">:</span>data
    child<span class="token punctuation">:</span><span class="token function">C</span><span class="token punctuation">(</span>
      data<span class="token punctuation">:</span>data
      child<span class="token punctuation">:</span><span class="token function">F</span><span class="token punctuation">(</span>
        data<span class="token punctuation">:</span>data
      <span class="token punctuation">)</span>   
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样的实现缺点非常明显，B、C组件不需要 data 数据，如果组件树比较深的话，那将是噩梦。</p> <p>为了处理此问题，Flutter Framework 提供了 InheritedWidget 组件，InheritedWidget 组件的子组件可以直接获取数据，如下图:</p> <p><img src="http://img.laomengit.com/20210117145102.png" alt=""></p> <p>InheritedWidget 组件的所有子组件都可以直接通过 <strong>BuildContext.dependOnInheritedWidgetOfExactType</strong> 获取数据。</p> <h3 id="inheritedwidget-基本用法"><a href="#inheritedwidget-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95" class="header-anchor">#</a> InheritedWidget 基本用法</h3> <p>上面分析了 InheritedWidget 组件的使用场景，下面用一个最简单的 demo 展示如何使用  InheritedWidget 组件。</p> <p>定一个用户信息共享数据的实体类，任何子组件都可以获取用户信息，用户信息实体类：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
  String name<span class="token punctuation">;</span>
  int age<span class="token punctuation">;</span>

  <span class="token function">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  bool <span class="token keyword">operator</span> <span class="token operator">==</span><span class="token punctuation">(</span>Object other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>other <span class="token operator">is</span> UserInfo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> old <span class="token operator">=</span> other <span class="token operator">as</span> UserInfo<span class="token punctuation">;</span>
    <span class="token keyword">return</span> name <span class="token operator">==</span> old<span class="token punctuation">.</span>name <span class="token operator">&amp;&amp;</span> age <span class="token operator">==</span> old<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>UserInfo 类重写了 <strong>==</strong> 操作符，是为了后面数据是否发生变化做判断。</p> <p>定义共享 UserInfo 数据的 InheritedWidget 组件。</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">MyInheritedWidget</span> <span class="token keyword">extends</span> <span class="token class-name">InheritedWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> UserInfo userInfo<span class="token punctuation">;</span>

  <span class="token function">MyInheritedWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>userInfo<span class="token punctuation">,</span> Widget child<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">super</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> MyInheritedWidget <span class="token function">of</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> context<span class="token punctuation">.</span>dependOnInheritedWidgetOfExactType<span class="token operator">&lt;</span>MyInheritedWidget<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  bool <span class="token function">updateShouldNotify</span><span class="token punctuation">(</span>covariant MyInheritedWidget oldWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> oldWidget<span class="token punctuation">.</span>userInfo <span class="token operator">!=</span> userInfo<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这里有两个地方需要注意:</p> <ol><li><p>静态(static) <strong>of</strong> 方法，这个方法不是必须的，但一般都会添加此方法，方便其子组件调用，当然也可以直接在子组件中使用 <strong>context.dependOnInheritedWidgetOfExactType</strong> 方法，不加 <strong>of</strong> 方法，子组件调用如下:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">F</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> myInheritedWidget <span class="token operator">=</span>
        context<span class="token punctuation">.</span>dependOnInheritedWidgetOfExactType<span class="token operator">&lt;</span>MyInheritedWidget<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'name:${myInheritedWidget.userInfo.name}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>添加静态(static) <strong>of</strong> 方法，用法如下:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">F</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'name:${MyInheritedWidget.of(context).userInfo.name}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我们经常使用的 <strong>MediaQuery.of(context)</strong> 和 <strong>Theme.of(context)</strong> 方法都是系统封装的此方法。</p></li> <li><p><strong>updateShouldNotify</strong> 方法必须重写，此方法是判断新的共享数据和原数据是否一致，是否将通知传递给所有子组件（已注册）。重建此组件时，有时需要重建继承 InheritedWidget 组件的组件，但有时不需要。 例如，如果此组件所保存的数据与“ oldWidget”所保存的数据相同，则我们无需重建继承了“ oldWidget”所保存的数据的组件。</p></li></ol> <p>使用 MyInheritedWidget 组件:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">InheritedWidgetDemo</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  _InheritedWidgetDemoState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_InheritedWidgetDemoState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_InheritedWidgetDemoState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>InheritedWidgetDemo<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'InheritedWidget Demo'</span><span class="token punctuation">)</span>，
      <span class="token punctuation">)</span>，
      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">MyInheritedWidget</span><span class="token punctuation">(</span>
          userInfo<span class="token punctuation">:</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟'</span>， age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span>，
          child<span class="token punctuation">:</span> <span class="token function">A</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>，
          <span class="token punctuation">)</span>，
        <span class="token punctuation">)</span>，
      <span class="token punctuation">)</span>，
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>A 组件代码:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> Widget child<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key， <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>
      child<span class="token punctuation">:</span> child，
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>F 组件代码:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">F</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'name:${MyInheritedWidget.of(context).userInfo.name}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上面代码构成的组件树为（无关的节点已忽略比如Scaffold、Center等）:</p> <p><img src="http://img.laomengit.com/20210117145109.png" alt=""></p> <blockquote><p>注意: A 组件是为了表示树的深度，此 Demo 中将其简化了，仅仅设置了一层，也可以设多多层。</p></blockquote> <p>运行效果:</p> <p><img src="http://img.laomengit.com/20210117145237.png" alt=""></p> <p>下面修改数据并刷新UI，下面的代码仅能用于Demo，是为了演示方便，千万不要用于实际项目，因为下面的写法有巨大的性能问题，因为重建了 InheritedWidget 组件下的所有子组件，重要的事情说3遍：<strong>下面演示Demo千万不要用于实际项目</strong>，<strong>千万不要用于实际项目</strong>，<strong>千万不要用于实际项目</strong>。文章最后我会给出正确用法。</p> <p>修改 <strong>_InheritedWidgetDemoState</strong> ：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">_InheritedWidgetDemoState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>InheritedWidgetDemo<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  UserInfo _userInfo <span class="token operator">=</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'InheritedWidget Demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">MyInheritedWidget</span><span class="token punctuation">(</span>
          userInfo<span class="token punctuation">:</span> _userInfo<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">A</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>
        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _userInfo <span class="token operator">=</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟1'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><img src="http://img.laomengit.com/20210117145245.gif" alt=""></p> <p>点击按钮的时候，UI刷新了，但请重点看右侧 <strong>rebuild stats</strong> 部分，每点击一次按钮，MyInheritedWidget 组件及其子组件全部 <strong>重新构建（rebuild）</strong>，但 A 组件并不依赖于 MyInheritedWidget 共享数据，理想情况下不应该 rebuild，实际项目中，树的结构会比这个复杂的多，因此全部 rebuild 会造成性能问题，这也是开头说千万不要将此方式用于实际项目，网上充斥着大量此种用法的文章，后面会给出正确用法，正确用法比较复杂，而且涉及其他相关知识，所以此处的Demo仅用于学习 InheritedWidget。</p> <p>大家是否还记得 <a href="../blog/20201227/Stateful%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" target="_blank" rel="noopener noreferrer">Stateful 组件的生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 文章中介绍的 <strong>didChangeDependencies</strong> 生命周期，对其的介绍如下：</p> <blockquote><p>didChangeDependencies 方法在 initState 之后由 Framework 立即调用。另外，当此 <strong>State</strong> 对象的依赖项更改时被调用，比如其所依赖的 <strong>InheritedWidget</strong> 发生变化时， Framework 会调用此方法通知组件发生变化。</p></blockquote> <p>下面将 A 和 F 组件改为 StatefulWidget 组件：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">F</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  _FState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_FState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_FState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>F<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'F initState'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'F build'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'name:${MyInheritedWidget.of(context).userInfo.name}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'F didChangeDependencies'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'F dispose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> Widget child<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  _AState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_AState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_AState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>A<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'A initState'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'A build'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>
      child<span class="token punctuation">:</span> widget<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'A didChangeDependencies'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'A dispose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p>给各个生命周期添加日志打印，重新运行，点击按钮，输出日志如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>flutter<span class="token punctuation">:</span> A build
flutter<span class="token punctuation">:</span> F didChangeDependencies
flutter<span class="token punctuation">:</span> F build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>因此，依赖 MyInheritedWidget 组件的 F 组件调用 <strong>didChangeDependencies</strong> 方法，而 A 组件没有调用 <strong>didChangeDependencies</strong> 方法，因为 A 没有依赖 MyInheritedWidget 组件。</p> <p>下面再说一个非常容易忽略的地方 <strong>MyInheritedWidget.updateShouldNotify</strong>方法，一般这样写：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
bool <span class="token function">updateShouldNotify</span><span class="token punctuation">(</span>covariant MyInheritedWidget oldWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> oldWidget<span class="token punctuation">.</span>userInfo <span class="token operator">!=</span> userInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样写有什么问题吗？如果数据（userInfo）是自定义的实体类且未在 UserInfo 中重写 <strong>==</strong>，那么极大概率出现有问题，因为不重写 <strong>==</strong> 操作符方法，使用 <strong>!=</strong> 判断是否相等的时候判断的是两个对象的内存地址，下面将 UserInfo 中  <strong>==</strong> 方法去掉，</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
  String name<span class="token punctuation">;</span>
  int age<span class="token punctuation">;</span>

  <span class="token function">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改 _InheritedWidgetDemoState 类：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">_InheritedWidgetDemoState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>InheritedWidgetDemo<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  UserInfo _userInfo <span class="token operator">=</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'InheritedWidget Demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">MyInheritedWidget</span><span class="token punctuation">(</span>
          userInfo<span class="token punctuation">:</span> _userInfo<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">A</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>
        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _userInfo <span class="token operator">=</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>修改 <strong>updateShouldNotify</strong> 方法，添加日志打印：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
bool <span class="token function">updateShouldNotify</span><span class="token punctuation">(</span>covariant MyInheritedWidget oldWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  bool flag <span class="token operator">=</span> oldWidget<span class="token punctuation">.</span>userInfo <span class="token operator">!=</span> userInfo<span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'updateShouldNotify:$flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> flag<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>点击按钮，_userInfo 对象引用发生了变化，但其值（ name 和 age）都没有发生变化，<strong>updateShouldNotify</strong> 应该返回false，但实际打印的结果：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>flutter<span class="token punctuation">:</span> updateShouldNotify<span class="token punctuation">:</span><span class="token boolean">true</span>
flutter<span class="token punctuation">:</span> A build
flutter<span class="token punctuation">:</span> F didChangeDependencies
flutter<span class="token punctuation">:</span> F build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>实际返回了 true，因为前后 _userInfo 对象引用发生了变化，在 UserInfo 中重写 <strong>==</strong>，比较具体的name 和 age 是否相等：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
bool <span class="token keyword">operator</span> <span class="token operator">==</span><span class="token punctuation">(</span>Object other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>other <span class="token operator">is</span> UserInfo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> old <span class="token operator">=</span> other <span class="token operator">as</span> UserInfo<span class="token punctuation">;</span>
  <span class="token keyword">return</span> name <span class="token operator">==</span> old<span class="token punctuation">.</span>name <span class="token operator">&amp;&amp;</span> age <span class="token operator">==</span> old<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>再次运行，日志如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>flutter<span class="token punctuation">:</span> updateShouldNotify<span class="token punctuation">:</span><span class="token boolean">false</span>
flutter<span class="token punctuation">:</span> A build
flutter<span class="token punctuation">:</span> F build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>还有一种错误写法：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">_InheritedWidgetDemoState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>InheritedWidgetDemo<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  UserInfo _userInfo <span class="token operator">=</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'InheritedWidget Demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token function">MyInheritedWidget</span><span class="token punctuation">(</span>
          userInfo<span class="token punctuation">:</span> _userInfo<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">A</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>
        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _userInfo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'老孟1'</span><span class="token punctuation">;</span>
            <span class="token comment">// _userInfo = UserInfo(name: '老孟', age: 18);</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>重点看这部分修改：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>
        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _userInfo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'老孟1'</span><span class="token punctuation">;</span>
            <span class="token comment">// _userInfo = UserInfo(name: '老孟', age: 18);</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>将 <strong>_userInfo = UserInfo(name: '老孟', age: 18)</strong> 修改为 <strong>_userInfo.name = '老孟1'</strong>，猜猜 updateShouldNotify 返回是 true or false？</p> <p>运行日志：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>flutter<span class="token punctuation">:</span> updateShouldNotify<span class="token punctuation">:</span><span class="token boolean">false</span>
flutter<span class="token punctuation">:</span> A build
flutter<span class="token punctuation">:</span> F build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>是不是感觉非常不可思议，两次的 <strong>name</strong> 值不一样啊？</p> <p>那是因为 <strong>_userInfo.name = '老孟1'</strong> 也修改了 oldWidget 的_userInfo，前后两次都指向了同一个对象引用。</p> <p>很多人应该会有这样一个疑问，假设设置 updateShouldNotify 返回false，点击的时候UI也会更改，因为整颗树都 rebuild 了，那么 updateShouldNotify 由什么意义呢？</p> <p>肯定是有意义的，看如下场景，F 组件使用 InheritedWidget 的共享数据访问服务器接口，获取服务器数据并展示，如果 updateShouldNotify 返回 false，那么 F 组件 rebuild 时只会执行 <strong>build</strong> 函数，而访问服务器接口是一个耗时工作，考虑性能因素，不能将访问服务器接口放在 <strong>build</strong> 函数中，那么 InheritedWidget 数据的更新就无法更新其依赖的组件，而 updateShouldNotify 返回 true时， F 组件 rebuild 时会执行 <strong>didChangeDependencies</strong> 和  <strong>build</strong> 函数，此时可以将访问服务器接口放在 <strong>didChangeDependencies</strong> 函数中，这也是 didChangeDependencies 生命周期存在的意义。</p> <p>下面<strong>重点来了</strong>，那么如何正确使用 <strong>InheritedWidget</strong> 组件，答案是 <strong>InheritedWidget + ValueNotifier</strong>，关于 ****的用法可以到我的个人博客中查看，地址：<a href="../flutter/widgets/ValueListenableBuilder.html" target="_blank" rel="noopener noreferrer">http://laomengit.com/flutter/widgets/ValueListenableBuilder.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，这里不详细展开介绍。</p> <p>修改 <strong>MyInheritedWidget</strong> 代码：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">MyInheritedWidget</span> <span class="token keyword">extends</span> <span class="token class-name">InheritedWidget</span> <span class="token punctuation">{</span>
  ValueNotifier<span class="token operator">&lt;</span>UserInfo<span class="token operator">&gt;</span> _valueNotifier<span class="token punctuation">;</span>

  ValueNotifier<span class="token operator">&lt;</span>UserInfo<span class="token operator">&gt;</span> <span class="token keyword">get</span> valueNotifier <span class="token operator">=</span><span class="token operator">&gt;</span> _valueNotifier<span class="token punctuation">;</span>

  <span class="token function">MyInheritedWidget</span><span class="token punctuation">(</span>UserInfo userInfo<span class="token punctuation">,</span> <span class="token punctuation">{</span>Widget child<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _valueNotifier <span class="token operator">=</span> ValueNotifier<span class="token operator">&lt;</span>UserInfo<span class="token operator">&gt;</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> MyInheritedWidget <span class="token function">of</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> context<span class="token punctuation">.</span>getElementForInheritedWidgetOfExactType<span class="token operator">&lt;</span>MyInheritedWidget<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>widget<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">updateData</span><span class="token punctuation">(</span>UserInfo info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _valueNotifier<span class="token punctuation">.</span>value <span class="token operator">=</span> info<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  bool <span class="token function">updateShouldNotify</span><span class="token punctuation">(</span>covariant MyInheritedWidget oldWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>主要的变化是：</p> <ul><li><p>共享数据由 UserInfo 类型变为了 ValueNotifier&lt;UserInfo&gt;。</p></li> <li><p>增加了更新数据的方法 <strong>updateData</strong>。</p></li> <li><p><strong>updateShouldNotify</strong> 方法直接返回了 false，因为数据的更新通过 ValueNotifier 实现。</p></li> <li><p>静态方法 <strong>of</strong> 由</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">static</span> MyInheritedWidget <span class="token function">of</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> context<span class="token punctuation">.</span>dependOnInheritedWidgetOfExactType<span class="token operator">&lt;</span>MyInheritedWidget<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>改为</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">static</span> MyInheritedWidget <span class="token function">of</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> context<span class="token punctuation">.</span>getElementForInheritedWidgetOfExactType<span class="token operator">&lt;</span>MyInheritedWidget<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>widget<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>区别是 <strong>dependOnInheritedWidgetOfExactType</strong> 注册了依赖关系，而 <strong>getElementForInheritedWidgetOfExactType</strong> 未注册，后面的源码部分会详细分析。</p></li></ul> <p>修改 F 组件的代码：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">F</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  _FState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_FState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_FState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>F<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'F initState'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'F didChangeDependencies'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'F build'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">ValueListenableBuilder</span><span class="token punctuation">(</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> UserInfo value<span class="token punctuation">,</span> child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'${value.name}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      valueListenable<span class="token punctuation">:</span> MyInheritedWidget<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>valueNotifier<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'F dispose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>变化：</p> <ul><li>依赖共享数据的Text组件添加了 <strong>ValueListenableBuilder</strong> 组件，数据发生变化时，重新执行 builder 。</li></ul> <p><strong>_InheritedWidgetDemoState</strong> 代码修改如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">MyInheritedWidget</span><span class="token punctuation">(</span><span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span> <span class="token function">Builder</span><span class="token punctuation">(</span>
    builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'InheritedWidget Demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
          child<span class="token punctuation">:</span> <span class="token function">A</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>
          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            MyInheritedWidget<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟${_clickCount++}'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>运行效果：</p> <p><img src="http://img.laomengit.com/20210117145306.gif" alt=""></p> <p>重点看  <strong>rebuild</strong> 的组件，无关的组件（比如 A）没有 <strong>rebuild</strong>。</p> <p>当然也可以使用 <strong>Provider</strong> 实现子组件更新，增加 <strong>UserInfoModel</strong>：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">UserInfoModel</span> <span class="token keyword">extends</span> <span class="token class-name">ChangeNotifier</span> <span class="token punctuation">{</span>
  <span class="token function">UserInfoModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

  UserInfo _userInfo<span class="token punctuation">;</span>

  UserInfo <span class="token keyword">get</span> userInfo <span class="token operator">=</span><span class="token operator">&gt;</span> _userInfo<span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span>UserInfo userInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _userInfo <span class="token operator">=</span> userInfo<span class="token punctuation">;</span>
    <span class="token function">notifyListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>修改 <strong>_InheritedWidgetDemoState</strong>：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">_InheritedWidgetDemoState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>InheritedWidgetDemo<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  int _clickCount <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">MultiProvider</span><span class="token punctuation">(</span>
      providers<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token function">ChangeNotifierProvider</span><span class="token punctuation">(</span>
            create<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">UserInfoModel</span><span class="token punctuation">(</span><span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
          appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'InheritedWidget Demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">A</span><span class="token punctuation">(</span>
              child<span class="token punctuation">:</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          floatingActionButton<span class="token punctuation">:</span> Consumer<span class="token operator">&lt;</span>UserInfoModel<span class="token operator">&gt;</span><span class="token punctuation">(</span>
            builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> userInfoModel<span class="token punctuation">,</span> child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> child<span class="token punctuation">,</span>
                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  userInfoModel<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token function">UserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'老孟${_clickCount++}'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><img src="http://img.laomengit.com/20210117145320.gif" alt=""></p> <h3 id="inheritedwidget-源码分析"><a href="#inheritedwidget-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90" class="header-anchor">#</a> InheritedWidget 源码分析</h3> <p>分析源码的时候一定要先想想，如果是我来实现这个组件，要如何实现？ InheritedWidget 组件主要实现了两个功能：</p> <ul><li>如何实现绑定依赖它的子组件</li> <li>如何通知子组件自己发生了更改。</li></ul> <h4 id="如何实现绑定依赖它的子组件"><a href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BB%91%E5%AE%9A%E4%BE%9D%E8%B5%96%E5%AE%83%E7%9A%84%E5%AD%90%E7%BB%84%E4%BB%B6" class="header-anchor">#</a> 如何实现绑定依赖它的子组件</h4> <p>依赖  InheritedWidget 的子组件如何获取 InheritedWidget 组件的共享数据？首先查看获取共享数据的方法：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>context<span class="token punctuation">.</span>dependOnInheritedWidgetOfExactType<span class="token operator">&lt;</span>MyInheritedWidget<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这段代码获取 <strong>MyInheritedWidget</strong> 实例，<strong>dependOnInheritedWidgetOfExactType</strong> 方法是 <strong>BuildContext</strong> 的方法，<strong>Element</strong> 实现了此方法：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
T dependOnInheritedWidgetOfExactType<span class="token operator">&lt;</span>T <span class="token keyword">extends</span> <span class="token class-name">InheritedWidget</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Object aspect<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token function">_debugCheckStateIsActiveForAncestorLookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> InheritedElement ancestor <span class="token operator">=</span> _inheritedWidgets <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> _inheritedWidgets<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ancestor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>ancestor <span class="token operator">is</span> InheritedElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">dependOnInheritedElement</span><span class="token punctuation">(</span>ancestor<span class="token punctuation">,</span> aspect<span class="token punctuation">:</span> aspect<span class="token punctuation">)</span> <span class="token operator">as</span> T<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  _hadUnsatisfiedDependencies <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>从上面的源代码可以看出，首先到 <strong>_inheritedWidgets</strong> 中查找指定的 InheritedElement，_inheritedWidgets 这个 Map 是哪里来的？什么时候被初始化的？看下 _inheritedWidgets 属性的定义：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>Map<span class="token operator">&lt;</span>Type<span class="token punctuation">,</span> InheritedElement<span class="token operator">&gt;</span> _inheritedWidgets<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查找其引用和赋值的源代码：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
<span class="token keyword">void</span> <span class="token function">_updateInheritance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span>_active<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> Map<span class="token operator">&lt;</span>Type<span class="token punctuation">,</span> InheritedElement<span class="token operator">&gt;</span> incomingWidgets <span class="token operator">=</span> _parent<span class="token operator">?</span><span class="token punctuation">.</span>_inheritedWidgets<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>incomingWidgets <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    _inheritedWidgets <span class="token operator">=</span> HashMap<span class="token operator">&lt;</span>Type<span class="token punctuation">,</span> InheritedElement<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>incomingWidgets<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    _inheritedWidgets <span class="token operator">=</span> HashMap<span class="token operator">&lt;</span>Type<span class="token punctuation">,</span> InheritedElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _inheritedWidgets<span class="token punctuation">[</span>widget<span class="token punctuation">.</span>runtimeType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>上面的代码在 <strong>InheritedElement</strong> 中，但此方法在 <strong>Element</strong> 中也实现了：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">void</span> <span class="token function">_updateInheritance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span>_active<span class="token punctuation">)</span><span class="token punctuation">;</span>
  _inheritedWidgets <span class="token operator">=</span> _parent<span class="token operator">?</span><span class="token punctuation">.</span>_inheritedWidgets<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面的代码说明了非 <strong>InheritedElement</strong> 的 Element 中 _inheritedWidgets 等于父组件的 _inheritedWidgets，而 InheritedElement 会将自身添加到 _inheritedWidgets 中，系统通过此方式将组件和 InheritedWidgets 的依赖关系层层向下传递，每一个 Element 中都含有 _inheritedWidgets 集合，此集合中包含了此组件的父组件且是InheritedWidgets 组件的引用关系。</p> <p>那么是什么时候执行的 _updateInheritance 方法的呢？通过查找其引用，发现在 <strong>mount</strong> 和 <strong>activate</strong> 中调用了  _updateInheritance 方法。关于 <strong>mount</strong> 和 <strong>activate</strong> 阶段可以查看  <a href="../blog/20201227/Stateful%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" target="_blank" rel="noopener noreferrer">Stateful 组件的生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 文章。</p> <p>下面查看 <strong>dependOnInheritedElement</strong> 方法，在查找到依赖的 <strong>InheritedElement</strong> 后，执行 <strong>dependOnInheritedElement</strong> 方法，源代码如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
InheritedWidget <span class="token function">dependOnInheritedElement</span><span class="token punctuation">(</span>InheritedElement ancestor<span class="token punctuation">,</span> <span class="token punctuation">{</span> Object aspect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span>ancestor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _dependencies <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">=</span> HashSet<span class="token operator">&lt;</span>InheritedElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _dependencies<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ancestor<span class="token punctuation">.</span><span class="token function">updateDependencies</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> aspect<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ancestor<span class="token punctuation">.</span>widget<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>updateDependencies 方法源代码如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@protected</span>
<span class="token keyword">void</span> <span class="token function">updateDependencies</span><span class="token punctuation">(</span>Element dependent<span class="token punctuation">,</span> Object aspect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setDependencies</span><span class="token punctuation">(</span>dependent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token metadata symbol">@protected</span>
  <span class="token keyword">void</span> <span class="token function">setDependencies</span><span class="token punctuation">(</span>Element dependent<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _dependents<span class="token punctuation">[</span>dependent<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>上面的代码就是向 <strong>_dependents</strong> 中添加注册， InheritedWidget 组件更新时可以更具此列表通知子组件。</p> <p>再来看下的代码：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@Deprecated</span><span class="token punctuation">(</span>
  <span class="token string">'Use getElementForInheritedWidgetOfExactType instead. '</span>
  <span class="token string">'This feature was deprecated after v1.12.1.'</span>
<span class="token punctuation">)</span>
<span class="token metadata symbol">@override</span>
InheritedElement <span class="token function">ancestorInheritedElementForWidgetOfExactType</span><span class="token punctuation">(</span>Type targetType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token function">_debugCheckStateIsActiveForAncestorLookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> InheritedElement ancestor <span class="token operator">=</span> _inheritedWidgets <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> _inheritedWidgets<span class="token punctuation">[</span>targetType<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ancestor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token metadata symbol">@override</span>
InheritedElement getElementForInheritedWidgetOfExactType<span class="token operator">&lt;</span>T <span class="token keyword">extends</span> <span class="token class-name">InheritedWidget</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token function">_debugCheckStateIsActiveForAncestorLookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> InheritedElement ancestor <span class="token operator">=</span> _inheritedWidgets <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> _inheritedWidgets<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ancestor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>在 v1.12.1 版本以前使用 <strong>ancestorInheritedElementForWidgetOfExactType</strong> 方法，现在使用 <strong>getElementForInheritedWidgetOfExactType</strong> 方法，此方法和 <strong>dependOnInheritedWidgetOfExactType</strong> 方法的唯一却不就是 getElementForInheritedWidgetOfExactType 方法没有注册，也就是使用 getElementForInheritedWidgetOfExactType 方法获取共享数据的子组件，不会在 InheritedWidget 组件重建时调用 <strong>didChangeDependencies</strong> 方法。</p> <p>下面看看为什么 InheritedWidget 组件数据方式变化，重建时会调用其  <strong>didChangeDependencies</strong> 方法？</p> <p>当组件发生变化时会调用 <strong>update</strong>方法：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span>ProxyWidget newWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> ProxyWidget oldWidget <span class="token operator">=</span> widget<span class="token punctuation">;</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span>widget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span>widget <span class="token operator">!=</span> newWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>newWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span>widget <span class="token operator">==</span> newWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updated</span><span class="token punctuation">(</span>oldWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
  _dirty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token function">rebuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>InheritedElement 重写了 <strong>updated</strong> 方法：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
<span class="token keyword">void</span> <span class="token function">updated</span><span class="token punctuation">(</span>InheritedWidget oldWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>widget<span class="token punctuation">.</span><span class="token function">updateShouldNotify</span><span class="token punctuation">(</span>oldWidget<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">updated</span><span class="token punctuation">(</span>oldWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当 <strong>updateShouldNotify</strong> 返回 true时，执行更新操作。而其父类的 <strong>updated</strong> 方法如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@protected</span>
<span class="token keyword">void</span> <span class="token function">updated</span><span class="token punctuation">(</span>covariant ProxyWidget oldWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">notifyClients</span><span class="token punctuation">(</span>oldWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>notifyClients 方法源代码：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@override</span>
<span class="token keyword">void</span> <span class="token function">notifyClients</span><span class="token punctuation">(</span>InheritedWidget oldWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token function">_debugCheckOwnerBuildTargetExists</span><span class="token punctuation">(</span><span class="token string">'notifyClients'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> Element dependent <span class="token keyword">in</span> _dependents<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// check that it really is our descendant</span>
      Element ancestor <span class="token operator">=</span> dependent<span class="token punctuation">.</span>_parent<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>ancestor <span class="token operator">!=</span> <span class="token keyword">this</span> <span class="token operator">&amp;&amp;</span> ancestor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        ancestor <span class="token operator">=</span> ancestor<span class="token punctuation">.</span>_parent<span class="token punctuation">;</span>
      <span class="token keyword">return</span> ancestor <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// check that it really depends on us</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>dependent<span class="token punctuation">.</span>_dependencies<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">notifyDependent</span><span class="token punctuation">(</span>oldWidget<span class="token punctuation">,</span> dependent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>遍历 <strong>_dependents</strong>，上面已经介绍，_dependents 是依赖它的子组件集合，遍历调用 <strong>notifyDependent</strong> 方法：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token metadata symbol">@protected</span>
<span class="token keyword">void</span> <span class="token function">notifyDependent</span><span class="token punctuation">(</span>covariant InheritedWidget oldWidget<span class="token punctuation">,</span> Element dependent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  dependent<span class="token punctuation">.</span><span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这里调用了 <strong>didChangeDependencies</strong> 方法，这也是 InheritedWidget 组件发生变化，重建时执行生命周期 <strong>didChangeDependencies</strong>。</p> <p>上面的代码都是在 InheritedElement 中的，在看下  InheritedWidget 的源代码：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">InheritedWidget</span> <span class="token keyword">extends</span> <span class="token class-name">ProxyWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function">InheritedWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Key key<span class="token punctuation">,</span> Widget child <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">,</span> child<span class="token punctuation">:</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  InheritedElement <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">InheritedElement</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@protected</span>
  bool <span class="token function">updateShouldNotify</span><span class="token punctuation">(</span>covariant InheritedWidget oldWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这个类非常简单，创建了一个 InheritedElement，定义了一个 updateShouldNotify 方法（上面已经详细介绍此方法的作用），子类需要重写。</p> <p>通过上面的源码解析，子组件获取共享数据时，实际是直接在  <strong>_inheritedWidgets</strong> 集合中匹配的，通过断点也可以查看其中的内容：</p> <p><img src="http://img.laomengit.com/20210117145332.png" alt=""></p> <h4 id="总结"><a href="#%E6%80%BB%E7%BB%93" class="header-anchor">#</a> 总结</h4> <p>通过上面的分析，InheritedWidget 组件流程如下：</p> <p><img src="http://img.laomengit.com/20210117145338.png" alt=""></p> <p>说明：</p> <ul><li>在当前组件的 <strong>mount</strong> 和 <strong>activate</strong> 阶段，系统调用 <strong>_updateInheritance</strong> 方法，将 InheritedWidget 类型的父组件添加到 <strong>_inheritedWidgets</strong> 集合中。</li> <li>子组件执行 <strong>dependOnInheritedWidgetOfExactType</strong> 方法时，从 <strong>_inheritedWidgets</strong> 集合中获取指定 InheritedWidget 类型的父组件，并将当前组件注册到 InheritedWidget 类型父组件的 <strong>_dependents</strong> 集合中。</li> <li>InheritedWidget 组件数据发生变化（<strong>updateShouldNotify</strong> 方法返回true），重建时，InheritedWidget 组件遍历 <strong>_dependents</strong> 集合中所有依赖的子组件，执行子组件的 <strong>didChangeDependencies</strong> 的方法。</li></ul> <h4 id="一点看法"><a href="#%E4%B8%80%E7%82%B9%E7%9C%8B%E6%B3%95" class="header-anchor">#</a> 一点看法</h4> <p>那么为什么是在当前组件的中保存这样一个 Map 集合，而不是依次向上查找呢（我最开始的想法）？</p> <p>下面是我个人的一点看法，如果你有不同的看法，欢迎一起讨论：</p> <p>当前组件的中保存这样一个 Map 集合，获取共享数据时直接定位依赖的 InheritedWidget，复杂度 O(1) 。</p> <p>而依次向上查找的复杂度是 O(n)，树的结构越深，消耗时间越长，复杂度线性增长。</p></div> <footer class="page-edit"><div class="gitbook-donate"><div></div> <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}"><span>喜欢作者</span></button><div id="QR" style="display: none;"><div id="wechat" style="display: inline-block"><a href="http://img.laomengit.com/laomeng_reward.png" rel="group" class="fancybox"><img id="wechat_qr" src="http://img.laomengit.com/laomeng_reward.png" alt="WeChat Pay"></a> <p>微信打赏</p></div></div></div> <!----></footer> <!----> </main> <!----></div><div class="global-ui"><div class="reading-progress top" data-v-21b39eda><div class="progress" data-v-21b39eda></div></div></div></div>
    <script src="../assets/js/app.fb541e49.js" defer></script><script src="../assets/js/2.ed846731.js" defer></script><script src="../assets/js/55.c1bbd918.js" defer></script>
  </body>
</html>